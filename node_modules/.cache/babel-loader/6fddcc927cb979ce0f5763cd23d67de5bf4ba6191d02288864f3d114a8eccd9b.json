{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\thato\\\\Downloads\\\\car-app\\\\src\\\\components\\\\messages\\\\MessagesView.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport { MessageCircle, Search, Send, User, ArrowLeft, Check, CheckCheck, Phone, Video, Info } from 'lucide-react';\nimport { useApp } from '../../context/AppContext.tsx';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n// Virtual scrolling constants\nconst MESSAGE_HEIGHT = 80; // Approximate message height\nconst OVERSCAN = 5; // Number of items to render outside visible area\n\nexport function MessagesView() {\n  _s();\n  var _state$currentUser7, _state$currentUser9, _state$currentUser1;\n  const {\n    state,\n    sendMessage,\n    markMessagesAsRead\n  } = useApp();\n  const [selectedConversation, setSelectedConversation] = useState(null);\n  const [messageText, setMessageText] = useState('');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [typingUsers, setTypingUsers] = useState([]);\n  const [isTyping, setIsTyping] = useState(false);\n  const [scrollTop, setScrollTop] = useState(0);\n  const [containerHeight, setContainerHeight] = useState(0);\n  const messagesEndRef = useRef(null);\n  const messagesContainerRef = useRef(null);\n  const typingTimeoutRef = useRef();\n\n  // Debug logging\n  useEffect(() => {\n    var _state$currentUser;\n    console.log('🔍 MessagesView Debug:', {\n      messagesCount: state.messages.length,\n      usersCount: state.users.length,\n      currentUser: (_state$currentUser = state.currentUser) === null || _state$currentUser === void 0 ? void 0 : _state$currentUser.username,\n      messages: state.messages.slice(0, 3).map(m => ({\n        id: m.id,\n        senderId: m.senderId,\n        receiverId: m.receiverId,\n        content: m.content.substring(0, 30) + '...'\n      })),\n      users: state.users.slice(0, 5).map(u => ({\n        id: u.id,\n        username: u.username\n      }))\n    });\n  }, [state.messages, state.users, state.currentUser]);\n\n  // Handle scroll for virtual scrolling\n  const handleScroll = useCallback(e => {\n    const target = e.target;\n    setScrollTop(target.scrollTop);\n  }, []);\n\n  // Measure container height\n  useEffect(() => {\n    const updateHeight = () => {\n      if (messagesContainerRef.current) {\n        setContainerHeight(messagesContainerRef.current.clientHeight);\n      }\n    };\n    updateHeight();\n    window.addEventListener('resize', updateHeight);\n    return () => window.removeEventListener('resize', updateHeight);\n  }, []);\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    // Use setTimeout to ensure DOM has been updated before scrolling\n    const timeoutId = setTimeout(() => {\n      scrollToBottom();\n    }, 50); // Reduced delay for smoother experience\n\n    return () => clearTimeout(timeoutId);\n  }, [state.messages, selectedConversation]);\n\n  // Scroll to bottom when conversation is first selected\n  useEffect(() => {\n    if (selectedConversation) {\n      const timeoutId = setTimeout(() => {\n        scrollToBottom();\n      }, 100);\n      return () => clearTimeout(timeoutId);\n    }\n  }, [selectedConversation]);\n\n  // Clean up typing indicators that are too old\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = Date.now();\n      setTypingUsers(prev => prev.filter(typing => now - typing.timestamp < 3000));\n    }, 1000);\n    return () => clearInterval(interval);\n  }, []);\n  const scrollToBottom = () => {\n    if (messagesContainerRef.current) {\n      messagesContainerRef.current.scrollTop = messagesContainerRef.current.scrollHeight;\n    }\n  };\n\n  // Create conversations from messages\n  const conversations = useMemo(() => {\n    const convMap = new Map();\n    state.messages.forEach(message => {\n      var _message$senderId, _message$senderId2, _message$receiverId, _message$receiverId2, _state$currentUser2, _state$currentUser3;\n      // Handle both string IDs and populated user objects\n      const messageSenderId = typeof message.senderId === 'string' ? message.senderId : ((_message$senderId = message.senderId) === null || _message$senderId === void 0 ? void 0 : _message$senderId.id) || ((_message$senderId2 = message.senderId) === null || _message$senderId2 === void 0 ? void 0 : _message$senderId2._id);\n      const messageReceiverId = typeof message.receiverId === 'string' ? message.receiverId : ((_message$receiverId = message.receiverId) === null || _message$receiverId === void 0 ? void 0 : _message$receiverId.id) || ((_message$receiverId2 = message.receiverId) === null || _message$receiverId2 === void 0 ? void 0 : _message$receiverId2._id);\n      const otherUserId = messageSenderId === ((_state$currentUser2 = state.currentUser) === null || _state$currentUser2 === void 0 ? void 0 : _state$currentUser2.id) ? messageReceiverId : messageSenderId;\n      const conversationId = [(_state$currentUser3 = state.currentUser) === null || _state$currentUser3 === void 0 ? void 0 : _state$currentUser3.id, otherUserId].sort().join('-');\n      if (!convMap.has(conversationId)) {\n        var _state$currentUser4;\n        convMap.set(conversationId, {\n          id: conversationId,\n          participants: [(_state$currentUser4 = state.currentUser) === null || _state$currentUser4 === void 0 ? void 0 : _state$currentUser4.id, otherUserId],\n          lastMessage: message,\n          unreadCount: 0,\n          updatedAt: message.timestamp\n        });\n      } else {\n        const existing = convMap.get(conversationId);\n        if (new Date(message.timestamp) > new Date(existing.lastMessage.timestamp)) {\n          existing.lastMessage = message;\n          existing.updatedAt = message.timestamp;\n        }\n      }\n    });\n\n    // Calculate unread counts\n    convMap.forEach(conversation => {\n      const unreadMessages = state.messages.filter(msg => {\n        var _msg$receiverId, _msg$receiverId2, _msg$senderId, _msg$senderId2, _state$currentUser5;\n        // Handle populated user objects in unread count calculation too\n        const msgReceiverId = typeof msg.receiverId === 'string' ? msg.receiverId : ((_msg$receiverId = msg.receiverId) === null || _msg$receiverId === void 0 ? void 0 : _msg$receiverId.id) || ((_msg$receiverId2 = msg.receiverId) === null || _msg$receiverId2 === void 0 ? void 0 : _msg$receiverId2._id);\n        const msgSenderId = typeof msg.senderId === 'string' ? msg.senderId : ((_msg$senderId = msg.senderId) === null || _msg$senderId === void 0 ? void 0 : _msg$senderId.id) || ((_msg$senderId2 = msg.senderId) === null || _msg$senderId2 === void 0 ? void 0 : _msg$senderId2._id);\n        return msgReceiverId === ((_state$currentUser5 = state.currentUser) === null || _state$currentUser5 === void 0 ? void 0 : _state$currentUser5.id) && !msg.read && (msgSenderId === conversation.participants[0] || msgSenderId === conversation.participants[1]);\n      });\n      conversation.unreadCount = unreadMessages.length;\n    });\n    const conversationsArray = Array.from(convMap.values()).sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n\n    // Debug: Check for missing users\n    const missingUsers = conversationsArray.map(conv => {\n      const otherUserId = conv.participants.find(p => {\n        var _state$currentUser6;\n        return p !== ((_state$currentUser6 = state.currentUser) === null || _state$currentUser6 === void 0 ? void 0 : _state$currentUser6.id);\n      });\n      const otherUser = state.users.find(u => u.id === otherUserId);\n      return {\n        otherUserId,\n        found: !!otherUser,\n        username: otherUser === null || otherUser === void 0 ? void 0 : otherUser.username\n      };\n    });\n    console.log('🔍 Conversations Debug:', {\n      conversationsCount: conversationsArray.length,\n      missingUsers: missingUsers.filter(u => !u.found),\n      allUserMappings: missingUsers\n    });\n    return conversationsArray;\n  }, [state.messages, (_state$currentUser7 = state.currentUser) === null || _state$currentUser7 === void 0 ? void 0 : _state$currentUser7.id, state.users]);\n\n  // Filter conversations based on search\n  const filteredConversations = useMemo(() => {\n    if (!searchTerm) return conversations;\n    return conversations.filter(conversation => {\n      const otherUserId = conversation.participants.find(p => {\n        var _state$currentUser8;\n        return p !== ((_state$currentUser8 = state.currentUser) === null || _state$currentUser8 === void 0 ? void 0 : _state$currentUser8.id);\n      });\n      const otherUser = state.users.find(u => u.id === otherUserId);\n      return otherUser === null || otherUser === void 0 ? void 0 : otherUser.username.toLowerCase().includes(searchTerm.toLowerCase());\n    });\n  }, [conversations, searchTerm, state.users, (_state$currentUser9 = state.currentUser) === null || _state$currentUser9 === void 0 ? void 0 : _state$currentUser9.id]);\n\n  // Get messages for selected conversation\n  const conversationMessages = useMemo(() => {\n    if (!selectedConversation) return [];\n    const conversation = conversations.find(c => c.id === selectedConversation);\n    if (!conversation) return [];\n    return state.messages.filter(msg => {\n      var _msg$senderId3, _msg$senderId4, _msg$receiverId3, _msg$receiverId4;\n      // Handle populated user objects\n      const msgSenderId = typeof msg.senderId === 'string' ? msg.senderId : ((_msg$senderId3 = msg.senderId) === null || _msg$senderId3 === void 0 ? void 0 : _msg$senderId3.id) || ((_msg$senderId4 = msg.senderId) === null || _msg$senderId4 === void 0 ? void 0 : _msg$senderId4._id);\n      const msgReceiverId = typeof msg.receiverId === 'string' ? msg.receiverId : ((_msg$receiverId3 = msg.receiverId) === null || _msg$receiverId3 === void 0 ? void 0 : _msg$receiverId3.id) || ((_msg$receiverId4 = msg.receiverId) === null || _msg$receiverId4 === void 0 ? void 0 : _msg$receiverId4._id);\n      const participants = conversation.participants;\n      return msgSenderId === participants[0] && msgReceiverId === participants[1] || msgSenderId === participants[1] && msgReceiverId === participants[0];\n    }).sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n  }, [selectedConversation, conversations, state.messages]);\n\n  // Get other user in selected conversation\n  const selectedConversationUser = useMemo(() => {\n    if (!selectedConversation) return null;\n    const conversation = conversations.find(c => c.id === selectedConversation);\n    if (!conversation) return null;\n    const otherUserId = conversation.participants.find(p => {\n      var _state$currentUser0;\n      return p !== ((_state$currentUser0 = state.currentUser) === null || _state$currentUser0 === void 0 ? void 0 : _state$currentUser0.id);\n    });\n    return state.users.find(u => u.id === otherUserId) || null;\n  }, [selectedConversation, conversations, state.users, (_state$currentUser1 = state.currentUser) === null || _state$currentUser1 === void 0 ? void 0 : _state$currentUser1.id]);\n  const handleSendMessage = async () => {\n    if (!messageText.trim() || !selectedConversationUser || loading) return;\n    setLoading(true);\n    try {\n      await sendMessage({\n        senderId: state.currentUser.id,\n        receiverId: selectedConversationUser.id,\n        content: messageText.trim()\n      });\n      setMessageText('');\n      setIsTyping(false);\n\n      // Scroll to bottom after sending message\n      setTimeout(() => {\n        scrollToBottom();\n      }, 100);\n    } catch (error) {\n      console.error('Error sending message:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleKeyPress = e => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n  const handleTyping = value => {\n    setMessageText(value);\n    if (value.trim() && !isTyping) {\n      setIsTyping(true);\n      // In a real app, you'd emit typing indicator to other users via WebSocket\n    }\n\n    // Clear typing indicator after 2 seconds of no typing\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n    typingTimeoutRef.current = setTimeout(() => {\n      setIsTyping(false);\n    }, 2000);\n  };\n  const handleConversationSelect = async conversationId => {\n    setSelectedConversation(conversationId);\n\n    // Mark messages as read\n    const conversation = conversations.find(c => c.id === conversationId);\n    if (conversation && conversation.unreadCount > 0) {\n      try {\n        await markMessagesAsRead(conversationId);\n      } catch (error) {\n        console.error('Error marking messages as read:', error);\n      }\n    }\n  };\n  const formatTime = timestamp => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffInHours = (now.getTime() - date.getTime()) / (1000 * 60 * 60);\n    if (diffInHours < 24) {\n      return date.toLocaleTimeString([], {\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    } else if (diffInHours < 168) {\n      // 7 days\n      return date.toLocaleDateString([], {\n        weekday: 'short'\n      });\n    } else {\n      return date.toLocaleDateString([], {\n        month: 'short',\n        day: 'numeric'\n      });\n    }\n  };\n  const formatMessageTime = timestamp => {\n    return new Date(timestamp).toLocaleTimeString([], {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n  const renderConversationsList = () => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"w-full lg:w-96 border-r border-primary-700/30 flex flex-col\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-4 border-b border-primary-700/30\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-xl font-bold text-primary-100 mb-4\",\n        children: \"Messages\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative\",\n        children: [/*#__PURE__*/_jsxDEV(Search, {\n          className: \"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-primary-400\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Search conversations...\",\n          value: searchTerm,\n          onChange: e => setSearchTerm(e.target.value),\n          className: \"input-field pl-10 text-sm\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 overflow-y-auto\",\n      children: filteredConversations.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4 text-center\",\n        children: [/*#__PURE__*/_jsxDEV(MessageCircle, {\n          className: \"w-12 h-12 mx-auto mb-4 text-primary-400\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-primary-300\",\n          children: \"No conversations yet\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-sm text-primary-400 mt-1\",\n          children: \"Start trading to begin messaging with other users\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 346,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"space-y-1 p-2\",\n        children: filteredConversations.map(conversation => {\n          const otherUserId = conversation.participants.find(p => {\n            var _state$currentUser10;\n            return p !== ((_state$currentUser10 = state.currentUser) === null || _state$currentUser10 === void 0 ? void 0 : _state$currentUser10.id);\n          });\n          const otherUser = state.users.find(u => u.id === otherUserId);\n          const isSelected = selectedConversation === conversation.id;\n          return /*#__PURE__*/_jsxDEV(motion.div, {\n            whileHover: {\n              scale: 1.02\n            },\n            whileTap: {\n              scale: 0.98\n            },\n            onClick: () => handleConversationSelect(conversation.id),\n            className: `p-3 rounded-lg cursor-pointer transition-all ${isSelected ? 'bg-primary-600/30 border border-primary-500/50' : 'hover:bg-primary-800/30'}`,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"relative\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"w-12 h-12 bg-primary-800/50 rounded-full flex items-center justify-center\",\n                  children: otherUser !== null && otherUser !== void 0 && otherUser.avatar ? /*#__PURE__*/_jsxDEV(\"img\", {\n                    src: otherUser.avatar,\n                    alt: otherUser.username,\n                    className: \"w-full h-full object-cover rounded-full\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 374,\n                    columnNumber: 27\n                  }, this) : /*#__PURE__*/_jsxDEV(User, {\n                    className: \"w-6 h-6 text-primary-300\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 380,\n                    columnNumber: 27\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 372,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 371,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex-1 min-w-0\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center justify-between\",\n                  children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                    className: \"font-medium text-primary-100 truncate\",\n                    children: [\"@\", (otherUser === null || otherUser === void 0 ? void 0 : otherUser.username) || 'Unknown']\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 389,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-xs text-primary-400\",\n                    children: formatTime(conversation.lastMessage.timestamp)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 392,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 388,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center justify-between mt-1\",\n                  children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                    className: \"text-sm text-primary-300 truncate\",\n                    children: [((_conversation$lastMes, _conversation$lastMes2, _state$currentUser11) => {\n                      // Handle populated user objects for last message sender\n                      const lastMessageSenderId = typeof conversation.lastMessage.senderId === 'string' ? conversation.lastMessage.senderId : ((_conversation$lastMes = conversation.lastMessage.senderId) === null || _conversation$lastMes === void 0 ? void 0 : _conversation$lastMes.id) || ((_conversation$lastMes2 = conversation.lastMessage.senderId) === null || _conversation$lastMes2 === void 0 ? void 0 : _conversation$lastMes2._id);\n                      return lastMessageSenderId === ((_state$currentUser11 = state.currentUser) === null || _state$currentUser11 === void 0 ? void 0 : _state$currentUser11.id) ? 'You: ' : '';\n                    })(), conversation.lastMessage.content]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 398,\n                    columnNumber: 25\n                  }, this), conversation.unreadCount > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"bg-blue-500 text-white text-xs px-2 py-1 rounded-full min-w-[20px] text-center\",\n                    children: conversation.unreadCount > 99 ? '99+' : conversation.unreadCount\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 409,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 397,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 387,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 19\n            }, this)\n          }, conversation.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 17\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 322,\n    columnNumber: 5\n  }, this);\n  const renderChatInterface = () => {\n    if (!selectedConversation || !selectedConversationUser) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 flex items-center justify-center\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center\",\n          children: [/*#__PURE__*/_jsxDEV(MessageCircle, {\n            className: \"w-16 h-16 mx-auto mb-4 text-primary-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 430,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-xl font-semibold text-primary-100 mb-2\",\n            children: \"Select a conversation\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 431,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-primary-300\",\n            children: \"Choose a conversation to start messaging\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 432,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 429,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 428,\n        columnNumber: 9\n      }, this);\n    }\n    const typingUsersInConversation = typingUsers.filter(t => t.conversationId === selectedConversation);\n\n    // Virtual scrolling calculations - only if we have container height\n    let visibleMessages = conversationMessages;\n    let totalHeight = conversationMessages.length * MESSAGE_HEIGHT;\n    let offsetY = 0;\n    if (containerHeight > 0 && conversationMessages.length > 10) {\n      const visibleStartIndex = Math.floor(scrollTop / MESSAGE_HEIGHT);\n      const visibleEndIndex = Math.min(conversationMessages.length - 1, Math.ceil((scrollTop + containerHeight) / MESSAGE_HEIGHT));\n      const startIndex = Math.max(0, visibleStartIndex - OVERSCAN);\n      const endIndex = Math.min(conversationMessages.length - 1, visibleEndIndex + OVERSCAN);\n      visibleMessages = conversationMessages.slice(startIndex, endIndex + 1);\n      offsetY = startIndex * MESSAGE_HEIGHT;\n      console.log('🔍 Virtual scroll:', {\n        total: conversationMessages.length,\n        visible: `${startIndex}-${endIndex}`,\n        rendering: visibleMessages.length,\n        scrollTop,\n        containerHeight\n      });\n    }\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 flex flex-col h-full max-h-full overflow-hidden\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-none h-16 px-4 py-3 border-b border-primary-700/30 bg-primary-900/95 backdrop-blur-sm flex items-center justify-between z-20\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setSelectedConversation(null),\n            className: \"lg:hidden p-2 hover:bg-primary-800/50 rounded-full transition-colors\",\n            children: /*#__PURE__*/_jsxDEV(ArrowLeft, {\n              className: \"w-5 h-5 text-primary-300\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 475,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 471,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-10 h-10 bg-primary-800/50 rounded-full flex items-center justify-center\",\n            children: selectedConversationUser.avatar ? /*#__PURE__*/_jsxDEV(\"img\", {\n              src: selectedConversationUser.avatar,\n              alt: selectedConversationUser.username,\n              className: \"w-full h-full object-cover rounded-full\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 480,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(User, {\n              className: \"w-5 h-5 text-primary-300\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 486,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 478,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              className: \"font-semibold text-primary-100\",\n              children: [\"@\", selectedConversationUser.username]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 491,\n              columnNumber: 15\n            }, this), typingUsersInConversation.length > 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-sm text-blue-400\",\n              children: \"typing...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 495,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 490,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 470,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"p-2 hover:bg-primary-800/50 rounded-full transition-colors\",\n            children: /*#__PURE__*/_jsxDEV(Phone, {\n              className: \"w-5 h-5 text-primary-300\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 502,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 501,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"p-2 hover:bg-primary-800/50 rounded-full transition-colors\",\n            children: /*#__PURE__*/_jsxDEV(Video, {\n              className: \"w-5 h-5 text-primary-300\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 505,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 504,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"p-2 hover:bg-primary-800/50 rounded-full transition-colors\",\n            children: /*#__PURE__*/_jsxDEV(Info, {\n              className: \"w-5 h-5 text-primary-300\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 508,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 507,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 500,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: messagesContainerRef,\n        className: \"flex-1 min-h-0 max-h-full overflow-y-auto overflow-x-hidden scrollbar-hide messages-container\",\n        style: {\n          scrollbarWidth: 'none',\n          msOverflowStyle: 'none',\n          height: 'calc(100vh - 200px)' // Explicit height constraint\n        },\n        onScroll: handleScroll,\n        children: conversationMessages.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"h-full flex items-center justify-center p-4\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-primary-300\",\n              children: \"No messages yet\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 527,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-sm text-primary-400 mt-1\",\n              children: \"Send a message to start the conversation\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 528,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 526,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 525,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            height: totalHeight,\n            position: 'relative',\n            minHeight: '100%'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              transform: `translateY(${offsetY}px)`,\n              position: 'relative'\n            },\n            children: [visibleMessages.map((message, index) => {\n              var _message$senderId3, _message$senderId4, _conversationMessages, _conversationMessages2, _conversationMessages3, _conversationMessages4, _state$currentUser12;\n              const actualIndex = conversationMessages.findIndex(m => m.id === message.id);\n\n              // Handle populated user objects\n              const messageSenderId = typeof message.senderId === 'string' ? message.senderId : ((_message$senderId3 = message.senderId) === null || _message$senderId3 === void 0 ? void 0 : _message$senderId3.id) || ((_message$senderId4 = message.senderId) === null || _message$senderId4 === void 0 ? void 0 : _message$senderId4._id);\n              const prevMessageSenderId = actualIndex > 0 ? typeof conversationMessages[actualIndex - 1].senderId === 'string' ? conversationMessages[actualIndex - 1].senderId : ((_conversationMessages = conversationMessages[actualIndex - 1].senderId) === null || _conversationMessages === void 0 ? void 0 : _conversationMessages.id) || ((_conversationMessages2 = conversationMessages[actualIndex - 1].senderId) === null || _conversationMessages2 === void 0 ? void 0 : _conversationMessages2._id) : null;\n              const nextMessageSenderId = actualIndex < conversationMessages.length - 1 ? typeof conversationMessages[actualIndex + 1].senderId === 'string' ? conversationMessages[actualIndex + 1].senderId : ((_conversationMessages3 = conversationMessages[actualIndex + 1].senderId) === null || _conversationMessages3 === void 0 ? void 0 : _conversationMessages3.id) || ((_conversationMessages4 = conversationMessages[actualIndex + 1].senderId) === null || _conversationMessages4 === void 0 ? void 0 : _conversationMessages4._id) : null;\n              const isOwn = messageSenderId === ((_state$currentUser12 = state.currentUser) === null || _state$currentUser12 === void 0 ? void 0 : _state$currentUser12.id);\n              const showAvatar = actualIndex === 0 || prevMessageSenderId !== messageSenderId;\n              const isLastInGroup = actualIndex === conversationMessages.length - 1 || nextMessageSenderId !== messageSenderId;\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: `flex p-4 ${isOwn ? 'justify-end' : 'justify-start'}`,\n                style: {\n                  minHeight: MESSAGE_HEIGHT\n                },\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: `flex items-end space-x-2 max-w-xs lg:max-w-md ${isOwn ? 'flex-row-reverse space-x-reverse' : ''}`,\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"w-8 h-8 flex-shrink-0\",\n                    children: showAvatar && !isOwn && /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"w-8 h-8 bg-primary-800/50 rounded-full flex items-center justify-center\",\n                      children: selectedConversationUser.avatar ? /*#__PURE__*/_jsxDEV(\"img\", {\n                        src: selectedConversationUser.avatar,\n                        alt: selectedConversationUser.username,\n                        className: \"w-full h-full object-cover rounded-full\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 579,\n                        columnNumber: 33\n                      }, this) : /*#__PURE__*/_jsxDEV(User, {\n                        className: \"w-4 h-4 text-primary-300\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 585,\n                        columnNumber: 33\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 577,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 575,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `px-4 py-2 rounded-2xl ${isOwn ? 'bg-blue-600 text-white' : 'bg-primary-700/50 text-primary-100'} ${isLastInGroup ? '' : 'mb-1'}`,\n                    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                      className: \"text-sm whitespace-pre-wrap break-words\",\n                      children: message.content\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 601,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: `flex items-center justify-end mt-1 space-x-1 ${isOwn ? 'text-blue-200' : 'text-primary-400'}`,\n                      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"text-xs\",\n                        children: formatMessageTime(message.timestamp)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 607,\n                        columnNumber: 29\n                      }, this), isOwn && /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"flex items-center\",\n                        children: message.read ? /*#__PURE__*/_jsxDEV(CheckCheck, {\n                          className: \"w-3 h-3\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 613,\n                          columnNumber: 35\n                        }, this) : /*#__PURE__*/_jsxDEV(Check, {\n                          className: \"w-3 h-3\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 615,\n                          columnNumber: 35\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 611,\n                        columnNumber: 31\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 604,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 592,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 573,\n                  columnNumber: 23\n                }, this)\n              }, message.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 568,\n                columnNumber: 21\n              }, this);\n            }), typingUsersInConversation.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-end space-x-2 p-4\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-8 h-8 bg-primary-800/50 rounded-full flex items-center justify-center\",\n                children: /*#__PURE__*/_jsxDEV(User, {\n                  className: \"w-4 h-4 text-primary-300\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 630,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 629,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"bg-primary-700/50 px-4 py-2 rounded-2xl\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex space-x-1\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"w-2 h-2 bg-primary-400 rounded-full animate-bounce\",\n                    style: {\n                      animationDelay: '0ms'\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 634,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"w-2 h-2 bg-primary-400 rounded-full animate-bounce\",\n                    style: {\n                      animationDelay: '150ms'\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 635,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"w-2 h-2 bg-primary-400 rounded-full animate-bounce\",\n                    style: {\n                      animationDelay: '300ms'\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 636,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 633,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 632,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 628,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 539,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            ref: messagesEndRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 642,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 532,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-none h-auto p-4 border-t border-primary-700/30 bg-primary-900/95 backdrop-blur-sm z-20\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1\",\n            children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n              value: messageText,\n              onChange: e => handleTyping(e.target.value),\n              onKeyPress: handleKeyPress,\n              placeholder: \"Type a message...\",\n              className: \"message-input w-full px-4 py-3 bg-primary-800/50 border border-primary-700/30 rounded-xl text-primary-100 placeholder-primary-400 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all\",\n              rows: 1,\n              disabled: loading,\n              style: {\n                minHeight: '48px',\n                maxHeight: '120px',\n                lineHeight: '1.5',\n                paddingTop: '12px',\n                paddingBottom: '12px'\n              },\n              onInput: e => {\n                const target = e.target;\n                target.style.height = '48px';\n                target.style.height = Math.min(target.scrollHeight, 120) + 'px';\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 651,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 650,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleSendMessage,\n            disabled: !messageText.trim() || loading,\n            className: `p-3 rounded-xl transition-all flex-shrink-0 ${messageText.trim() && !loading ? 'bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-blue-500/25' : 'bg-primary-700/50 text-primary-400 cursor-not-allowed'}`,\n            children: /*#__PURE__*/_jsxDEV(Send, {\n              className: \"w-5 h-5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 682,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 673,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 649,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 648,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 467,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"absolute inset-0 bg-gradient-to-br from-primary-900 via-primary-900 to-primary-800 text-primary-100 overflow-hidden\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"h-full flex messages-view\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: `${selectedConversation ? 'hidden lg:flex' : 'flex'} w-full lg:w-1/3 xl:w-1/4 flex-col border-r border-primary-700/30 bg-primary-900/50 backdrop-blur-sm`,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-none h-16 px-4 py-3 border-b border-primary-700/30 flex items-center justify-between\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-lg font-semibold text-primary-100 flex items-center\",\n            children: [/*#__PURE__*/_jsxDEV(MessageCircle, {\n              className: \"w-5 h-5 mr-2 text-primary-400\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 700,\n              columnNumber: 15\n            }, this), \"Messages\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 699,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"p-2 hover:bg-primary-800/50 rounded-full transition-colors\",\n            children: /*#__PURE__*/_jsxDEV(Search, {\n              className: \"w-5 h-5 text-primary-300\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 704,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 703,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 698,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-1 min-h-0 overflow-y-auto scrollbar-hide\",\n          children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"animate-pulse space-y-3\",\n              children: [...Array(5)].map((_, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center space-x-3 p-3\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"w-10 h-10 bg-primary-700 rounded-full\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 715,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex-1\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"h-4 bg-primary-700 rounded w-3/4 mb-2\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 717,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"h-3 bg-primary-700 rounded w-1/2\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 718,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 716,\n                  columnNumber: 23\n                }, this)]\n              }, i, true, {\n                fileName: _jsxFileName,\n                lineNumber: 714,\n                columnNumber: 21\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 712,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 711,\n            columnNumber: 15\n          }, this) : conversations.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4 text-center\",\n            children: [/*#__PURE__*/_jsxDEV(MessageCircle, {\n              className: \"w-12 h-12 mx-auto mb-3 text-primary-400\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 726,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-primary-300\",\n              children: \"No conversations yet\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 727,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-sm text-primary-400 mt-1\",\n              children: \"Start a conversation to see it here\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 728,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 725,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-2\",\n            children: conversations.map(conversation => {\n              var _state$currentUser14;\n              const otherUserId = conversation.participants.find(p => {\n                var _state$currentUser13;\n                return p !== ((_state$currentUser13 = state.currentUser) === null || _state$currentUser13 === void 0 ? void 0 : _state$currentUser13.id);\n              });\n              if (!otherUserId) return null;\n              const otherUserData = state.users.find(u => u.id === otherUserId);\n              if (!otherUserData) return null;\n              const lastMessage = conversation.lastMessage;\n              const isSelected = selectedConversation === conversation.id;\n              const hasUnread = conversation.unreadCount > 0;\n              return /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => handleConversationSelect(conversation.id),\n                className: `w-full p-3 rounded-lg transition-all text-left hover:bg-primary-800/30 ${isSelected ? 'bg-primary-800/50 border-l-2 border-blue-500' : ''}`,\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center space-x-3\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"relative\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"w-10 h-10 bg-primary-800/50 rounded-full flex items-center justify-center\",\n                      children: otherUserData.avatar ? /*#__PURE__*/_jsxDEV(\"img\", {\n                        src: otherUserData.avatar,\n                        alt: otherUserData.username,\n                        className: \"w-full h-full object-cover rounded-full\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 755,\n                        columnNumber: 31\n                      }, this) : /*#__PURE__*/_jsxDEV(User, {\n                        className: \"w-5 h-5 text-primary-300\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 761,\n                        columnNumber: 31\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 753,\n                      columnNumber: 27\n                    }, this), hasUnread && /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"absolute -top-1 -right-1 w-5 h-5 bg-blue-600 rounded-full flex items-center justify-center\",\n                      children: /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"text-xs text-white font-medium\",\n                        children: conversation.unreadCount > 9 ? '9+' : conversation.unreadCount\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 766,\n                        columnNumber: 31\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 765,\n                      columnNumber: 29\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 752,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"flex-1 min-w-0\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"flex items-center justify-between mb-1\",\n                      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                        className: `font-medium truncate ${hasUnread ? 'text-primary-100' : 'text-primary-200'}`,\n                        children: [\"@\", otherUserData.username]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 775,\n                        columnNumber: 29\n                      }, this), lastMessage && /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"text-xs text-primary-400 flex-shrink-0 ml-2\",\n                        children: formatMessageTime(lastMessage.timestamp)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 781,\n                        columnNumber: 31\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 774,\n                      columnNumber: 27\n                    }, this), lastMessage && /*#__PURE__*/_jsxDEV(\"p\", {\n                      className: `text-sm truncate ${hasUnread ? 'text-primary-300 font-medium' : 'text-primary-400'}`,\n                      children: [lastMessage.senderId === ((_state$currentUser14 = state.currentUser) === null || _state$currentUser14 === void 0 ? void 0 : _state$currentUser14.id) ? 'You: ' : '', lastMessage.content]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 788,\n                      columnNumber: 29\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 773,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 751,\n                  columnNumber: 23\n                }, this)\n              }, conversation.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 744,\n                columnNumber: 21\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 731,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 709,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 694,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `${selectedConversation ? 'flex' : 'hidden lg:flex'} flex-1 flex flex-col min-h-0 max-h-full overflow-hidden`,\n        children: renderChatInterface()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 806,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 692,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 691,\n    columnNumber: 5\n  }, this);\n}\n_s(MessagesView, \"4+i+XIQ+7VmbBG9F1GnvJ6vrZFc=\", false, function () {\n  return [useApp];\n});\n_c = MessagesView;\nvar _c;\n$RefreshReg$(_c, \"MessagesView\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useMemo","useCallback","motion","MessageCircle","Search","Send","User","ArrowLeft","Check","CheckCheck","Phone","Video","Info","useApp","jsxDEV","_jsxDEV","MESSAGE_HEIGHT","OVERSCAN","MessagesView","_s","_state$currentUser7","_state$currentUser9","_state$currentUser1","state","sendMessage","markMessagesAsRead","selectedConversation","setSelectedConversation","messageText","setMessageText","searchTerm","setSearchTerm","loading","setLoading","typingUsers","setTypingUsers","isTyping","setIsTyping","scrollTop","setScrollTop","containerHeight","setContainerHeight","messagesEndRef","messagesContainerRef","typingTimeoutRef","_state$currentUser","console","log","messagesCount","messages","length","usersCount","users","currentUser","username","slice","map","m","id","senderId","receiverId","content","substring","u","handleScroll","e","target","updateHeight","current","clientHeight","window","addEventListener","removeEventListener","timeoutId","setTimeout","scrollToBottom","clearTimeout","interval","setInterval","now","Date","prev","filter","typing","timestamp","clearInterval","scrollHeight","conversations","convMap","Map","forEach","message","_message$senderId","_message$senderId2","_message$receiverId","_message$receiverId2","_state$currentUser2","_state$currentUser3","messageSenderId","_id","messageReceiverId","otherUserId","conversationId","sort","join","has","_state$currentUser4","set","participants","lastMessage","unreadCount","updatedAt","existing","get","conversation","unreadMessages","msg","_msg$receiverId","_msg$receiverId2","_msg$senderId","_msg$senderId2","_state$currentUser5","msgReceiverId","msgSenderId","read","conversationsArray","Array","from","values","a","b","getTime","missingUsers","conv","find","p","_state$currentUser6","otherUser","found","conversationsCount","allUserMappings","filteredConversations","_state$currentUser8","toLowerCase","includes","conversationMessages","c","_msg$senderId3","_msg$senderId4","_msg$receiverId3","_msg$receiverId4","selectedConversationUser","_state$currentUser0","handleSendMessage","trim","error","handleKeyPress","key","shiftKey","preventDefault","handleTyping","value","handleConversationSelect","formatTime","date","diffInHours","toLocaleTimeString","hour","minute","toLocaleDateString","weekday","month","day","formatMessageTime","renderConversationsList","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","placeholder","onChange","_state$currentUser10","isSelected","div","whileHover","scale","whileTap","onClick","avatar","src","alt","_conversation$lastMes","_conversation$lastMes2","_state$currentUser11","lastMessageSenderId","renderChatInterface","typingUsersInConversation","t","visibleMessages","totalHeight","offsetY","visibleStartIndex","Math","floor","visibleEndIndex","min","ceil","startIndex","max","endIndex","total","visible","rendering","ref","style","scrollbarWidth","msOverflowStyle","height","onScroll","position","minHeight","transform","index","_message$senderId3","_message$senderId4","_conversationMessages","_conversationMessages2","_conversationMessages3","_conversationMessages4","_state$currentUser12","actualIndex","findIndex","prevMessageSenderId","nextMessageSenderId","isOwn","showAvatar","isLastInGroup","animationDelay","onKeyPress","rows","disabled","maxHeight","lineHeight","paddingTop","paddingBottom","onInput","_","i","_state$currentUser14","_state$currentUser13","otherUserData","hasUnread","_c","$RefreshReg$"],"sources":["C:/Users/thato/Downloads/car-app/src/components/messages/MessagesView.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  MessageCircle, \n  Search, \n  Send, \n  User, \n  ArrowLeft, \n  MoreVertical,\n  Check,\n  CheckCheck,\n  Phone,\n  Video,\n  Info\n} from 'lucide-react';\nimport { useApp } from '../../context/AppContext.tsx';\nimport { Message, User as UserType, Conversation } from '../../types/index.ts';\n\ninterface TypingIndicator {\n  userId: string;\n  conversationId: string;\n  timestamp: number;\n}\n\n// Virtual scrolling constants\nconst MESSAGE_HEIGHT = 80; // Approximate message height\nconst OVERSCAN = 5; // Number of items to render outside visible area\n\nexport function MessagesView() {\n  const { state, sendMessage, markMessagesAsRead } = useApp();\n  const [selectedConversation, setSelectedConversation] = useState<string | null>(null);\n  const [messageText, setMessageText] = useState('');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [typingUsers, setTypingUsers] = useState<TypingIndicator[]>([]);\n  const [isTyping, setIsTyping] = useState(false);\n  const [scrollTop, setScrollTop] = useState(0);\n  const [containerHeight, setContainerHeight] = useState(0);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const messagesContainerRef = useRef<HTMLDivElement>(null);\n  const typingTimeoutRef = useRef<NodeJS.Timeout>();\n\n  // Debug logging\n  useEffect(() => {\n    console.log('🔍 MessagesView Debug:', {\n      messagesCount: state.messages.length,\n      usersCount: state.users.length,\n      currentUser: state.currentUser?.username,\n      messages: state.messages.slice(0, 3).map(m => ({\n        id: m.id,\n        senderId: m.senderId,\n        receiverId: m.receiverId,\n        content: m.content.substring(0, 30) + '...'\n      })),\n      users: state.users.slice(0, 5).map(u => ({ id: u.id, username: u.username }))\n    });\n  }, [state.messages, state.users, state.currentUser]);\n\n  // Handle scroll for virtual scrolling\n  const handleScroll = useCallback((e: React.UIEvent<HTMLDivElement>) => {\n    const target = e.target as HTMLDivElement;\n    setScrollTop(target.scrollTop);\n  }, []);\n\n  // Measure container height\n  useEffect(() => {\n    const updateHeight = () => {\n      if (messagesContainerRef.current) {\n        setContainerHeight(messagesContainerRef.current.clientHeight);\n      }\n    };\n\n    updateHeight();\n    window.addEventListener('resize', updateHeight);\n    return () => window.removeEventListener('resize', updateHeight);\n  }, []);\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    // Use setTimeout to ensure DOM has been updated before scrolling\n    const timeoutId = setTimeout(() => {\n      scrollToBottom();\n    }, 50); // Reduced delay for smoother experience\n\n    return () => clearTimeout(timeoutId);\n  }, [state.messages, selectedConversation]);\n\n  // Scroll to bottom when conversation is first selected\n  useEffect(() => {\n    if (selectedConversation) {\n      const timeoutId = setTimeout(() => {\n        scrollToBottom();\n      }, 100);\n\n      return () => clearTimeout(timeoutId);\n    }\n  }, [selectedConversation]);\n\n  // Clean up typing indicators that are too old\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = Date.now();\n      setTypingUsers(prev => prev.filter(typing => now - typing.timestamp < 3000));\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  const scrollToBottom = () => {\n    if (messagesContainerRef.current) {\n      messagesContainerRef.current.scrollTop = messagesContainerRef.current.scrollHeight;\n    }\n  };\n\n  // Create conversations from messages\n  const conversations = useMemo(() => {\n    const convMap = new Map<string, Conversation>();\n    \n    state.messages.forEach(message => {\n      // Handle both string IDs and populated user objects\n      const messageSenderId = typeof message.senderId === 'string' \n        ? message.senderId \n        : (message.senderId as any)?.id || (message.senderId as any)?._id;\n      const messageReceiverId = typeof message.receiverId === 'string' \n        ? message.receiverId \n        : (message.receiverId as any)?.id || (message.receiverId as any)?._id;\n\n      const otherUserId = messageSenderId === state.currentUser?.id \n        ? messageReceiverId \n        : messageSenderId;\n      \n      const conversationId = [state.currentUser?.id, otherUserId].sort().join('-');\n      \n      if (!convMap.has(conversationId)) {\n        convMap.set(conversationId, {\n          id: conversationId,\n          participants: [state.currentUser?.id!, otherUserId],\n          lastMessage: message,\n          unreadCount: 0,\n          updatedAt: message.timestamp\n        });\n      } else {\n        const existing = convMap.get(conversationId)!;\n        if (new Date(message.timestamp) > new Date(existing.lastMessage.timestamp)) {\n          existing.lastMessage = message;\n          existing.updatedAt = message.timestamp;\n        }\n      }\n    });\n\n    // Calculate unread counts\n    convMap.forEach(conversation => {\n      const unreadMessages = state.messages.filter(msg => {\n        // Handle populated user objects in unread count calculation too\n        const msgReceiverId = typeof msg.receiverId === 'string' \n          ? msg.receiverId \n          : (msg.receiverId as any)?.id || (msg.receiverId as any)?._id;\n        const msgSenderId = typeof msg.senderId === 'string' \n          ? msg.senderId \n          : (msg.senderId as any)?.id || (msg.senderId as any)?._id;\n\n        return msgReceiverId === state.currentUser?.id &&\n          !msg.read &&\n          (msgSenderId === conversation.participants[0] || msgSenderId === conversation.participants[1]);\n      });\n      conversation.unreadCount = unreadMessages.length;\n    });\n\n    const conversationsArray = Array.from(convMap.values()).sort((a, b) => \n      new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime()\n    );\n\n    // Debug: Check for missing users\n    const missingUsers = conversationsArray.map(conv => {\n      const otherUserId = conv.participants.find(p => p !== state.currentUser?.id);\n      const otherUser = state.users.find(u => u.id === otherUserId);\n      return { otherUserId, found: !!otherUser, username: otherUser?.username };\n    });\n\n    console.log('🔍 Conversations Debug:', {\n      conversationsCount: conversationsArray.length,\n      missingUsers: missingUsers.filter(u => !u.found),\n      allUserMappings: missingUsers\n    });\n\n    return conversationsArray;\n  }, [state.messages, state.currentUser?.id, state.users]);\n\n  // Filter conversations based on search\n  const filteredConversations = useMemo(() => {\n    if (!searchTerm) return conversations;\n    \n    return conversations.filter(conversation => {\n      const otherUserId = conversation.participants.find(p => p !== state.currentUser?.id);\n      const otherUser = state.users.find(u => u.id === otherUserId);\n      return otherUser?.username.toLowerCase().includes(searchTerm.toLowerCase());\n    });\n  }, [conversations, searchTerm, state.users, state.currentUser?.id]);\n\n  // Get messages for selected conversation\n  const conversationMessages = useMemo(() => {\n    if (!selectedConversation) return [];\n    \n    const conversation = conversations.find(c => c.id === selectedConversation);\n    if (!conversation) return [];\n    \n    return state.messages\n      .filter(msg => {\n        // Handle populated user objects\n        const msgSenderId = typeof msg.senderId === 'string' \n          ? msg.senderId \n          : (msg.senderId as any)?.id || (msg.senderId as any)?._id;\n        const msgReceiverId = typeof msg.receiverId === 'string' \n          ? msg.receiverId \n          : (msg.receiverId as any)?.id || (msg.receiverId as any)?._id;\n\n        const participants = conversation.participants;\n        return (\n          (msgSenderId === participants[0] && msgReceiverId === participants[1]) ||\n          (msgSenderId === participants[1] && msgReceiverId === participants[0])\n        );\n      })\n      .sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n  }, [selectedConversation, conversations, state.messages]);\n\n  // Get other user in selected conversation\n  const selectedConversationUser = useMemo(() => {\n    if (!selectedConversation) return null;\n    \n    const conversation = conversations.find(c => c.id === selectedConversation);\n    if (!conversation) return null;\n    \n    const otherUserId = conversation.participants.find(p => p !== state.currentUser?.id);\n    return state.users.find(u => u.id === otherUserId) || null;\n  }, [selectedConversation, conversations, state.users, state.currentUser?.id]);\n\n  const handleSendMessage = async () => {\n    if (!messageText.trim() || !selectedConversationUser || loading) return;\n\n    setLoading(true);\n    try {\n      await sendMessage({\n        senderId: state.currentUser!.id,\n        receiverId: selectedConversationUser.id,\n        content: messageText.trim()\n      });\n      setMessageText('');\n      setIsTyping(false);\n      \n      // Scroll to bottom after sending message\n      setTimeout(() => {\n        scrollToBottom();\n      }, 100);\n    } catch (error) {\n      console.error('Error sending message:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const handleTyping = (value: string) => {\n    setMessageText(value);\n    \n    if (value.trim() && !isTyping) {\n      setIsTyping(true);\n      // In a real app, you'd emit typing indicator to other users via WebSocket\n    }\n\n    // Clear typing indicator after 2 seconds of no typing\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n    \n    typingTimeoutRef.current = setTimeout(() => {\n      setIsTyping(false);\n    }, 2000);\n  };\n\n  const handleConversationSelect = async (conversationId: string) => {\n    setSelectedConversation(conversationId);\n    \n    // Mark messages as read\n    const conversation = conversations.find(c => c.id === conversationId);\n    if (conversation && conversation.unreadCount > 0) {\n      try {\n        await markMessagesAsRead(conversationId);\n      } catch (error) {\n        console.error('Error marking messages as read:', error);\n      }\n    }\n  };\n\n  const formatTime = (timestamp: string) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffInHours = (now.getTime() - date.getTime()) / (1000 * 60 * 60);\n    \n    if (diffInHours < 24) {\n      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    } else if (diffInHours < 168) { // 7 days\n      return date.toLocaleDateString([], { weekday: 'short' });\n    } else {\n      return date.toLocaleDateString([], { month: 'short', day: 'numeric' });\n    }\n  };\n\n  const formatMessageTime = (timestamp: string) => {\n    return new Date(timestamp).toLocaleTimeString([], { \n      hour: '2-digit', \n      minute: '2-digit' \n    });\n  };\n\n  const renderConversationsList = () => (\n    <div className=\"w-full lg:w-96 border-r border-primary-700/30 flex flex-col\">\n      {/* Header */}\n      <div className=\"p-4 border-b border-primary-700/30\">\n        <h2 className=\"text-xl font-bold text-primary-100 mb-4\">Messages</h2>\n        \n        {/* Search */}\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-primary-400\" />\n          <input\n            type=\"text\"\n            placeholder=\"Search conversations...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"input-field pl-10 text-sm\"\n          />\n        </div>\n      </div>\n\n      {/* Conversations List */}\n      <div className=\"flex-1 overflow-y-auto\">\n        {filteredConversations.length === 0 ? (\n          <div className=\"p-4 text-center\">\n            <MessageCircle className=\"w-12 h-12 mx-auto mb-4 text-primary-400\" />\n            <p className=\"text-primary-300\">No conversations yet</p>\n            <p className=\"text-sm text-primary-400 mt-1\">\n              Start trading to begin messaging with other users\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-1 p-2\">\n            {filteredConversations.map((conversation) => {\n              const otherUserId = conversation.participants.find(p => p !== state.currentUser?.id);\n              const otherUser = state.users.find(u => u.id === otherUserId);\n              const isSelected = selectedConversation === conversation.id;\n              \n              return (\n                <motion.div\n                  key={conversation.id}\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  onClick={() => handleConversationSelect(conversation.id)}\n                  className={`p-3 rounded-lg cursor-pointer transition-all ${\n                    isSelected\n                      ? 'bg-primary-600/30 border border-primary-500/50'\n                      : 'hover:bg-primary-800/30'\n                  }`}\n                >\n                  <div className=\"flex items-center space-x-3\">\n                    {/* Avatar */}\n                    <div className=\"relative\">\n                      <div className=\"w-12 h-12 bg-primary-800/50 rounded-full flex items-center justify-center\">\n                        {otherUser?.avatar ? (\n                          <img\n                            src={otherUser.avatar}\n                            alt={otherUser.username}\n                            className=\"w-full h-full object-cover rounded-full\"\n                          />\n                        ) : (\n                          <User className=\"w-6 h-6 text-primary-300\" />\n                        )}\n                      </div>\n                      {/* Online indicator could go here */}\n                    </div>\n                    \n                    {/* Content */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center justify-between\">\n                        <h4 className=\"font-medium text-primary-100 truncate\">\n                          @{otherUser?.username || 'Unknown'}\n                        </h4>\n                        <span className=\"text-xs text-primary-400\">\n                          {formatTime(conversation.lastMessage.timestamp)}\n                        </span>\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between mt-1\">\n                        <p className=\"text-sm text-primary-300 truncate\">\n                          {(() => {\n                            // Handle populated user objects for last message sender\n                            const lastMessageSenderId = typeof conversation.lastMessage.senderId === 'string' \n                              ? conversation.lastMessage.senderId \n                              : (conversation.lastMessage.senderId as any)?.id || (conversation.lastMessage.senderId as any)?._id;\n                            return lastMessageSenderId === state.currentUser?.id ? 'You: ' : '';\n                          })()}\n                          {conversation.lastMessage.content}\n                        </p>\n                        {conversation.unreadCount > 0 && (\n                          <span className=\"bg-blue-500 text-white text-xs px-2 py-1 rounded-full min-w-[20px] text-center\">\n                            {conversation.unreadCount > 99 ? '99+' : conversation.unreadCount}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </motion.div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n\n  const renderChatInterface = () => {\n    if (!selectedConversation || !selectedConversationUser) {\n      return (\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <MessageCircle className=\"w-16 h-16 mx-auto mb-4 text-primary-400\" />\n            <h3 className=\"text-xl font-semibold text-primary-100 mb-2\">Select a conversation</h3>\n            <p className=\"text-primary-300\">Choose a conversation to start messaging</p>\n          </div>\n        </div>\n      );\n    }\n\n    const typingUsersInConversation = typingUsers.filter(t => t.conversationId === selectedConversation);\n\n    // Virtual scrolling calculations - only if we have container height\n    let visibleMessages = conversationMessages;\n    let totalHeight = conversationMessages.length * MESSAGE_HEIGHT;\n    let offsetY = 0;\n\n    if (containerHeight > 0 && conversationMessages.length > 10) {\n      const visibleStartIndex = Math.floor(scrollTop / MESSAGE_HEIGHT);\n      const visibleEndIndex = Math.min(\n        conversationMessages.length - 1,\n        Math.ceil((scrollTop + containerHeight) / MESSAGE_HEIGHT)\n      );\n      const startIndex = Math.max(0, visibleStartIndex - OVERSCAN);\n      const endIndex = Math.min(conversationMessages.length - 1, visibleEndIndex + OVERSCAN);\n      \n      visibleMessages = conversationMessages.slice(startIndex, endIndex + 1);\n      offsetY = startIndex * MESSAGE_HEIGHT;\n      \n      console.log('🔍 Virtual scroll:', {\n        total: conversationMessages.length,\n        visible: `${startIndex}-${endIndex}`,\n        rendering: visibleMessages.length,\n        scrollTop,\n        containerHeight\n      });\n    }\n\n    return (\n      <div className=\"flex-1 flex flex-col h-full max-h-full overflow-hidden\">\n        {/* Chat Header - Fixed height */}\n        <div className=\"flex-none h-16 px-4 py-3 border-b border-primary-700/30 bg-primary-900/95 backdrop-blur-sm flex items-center justify-between z-20\">\n          <div className=\"flex items-center space-x-3\">\n            <button\n              onClick={() => setSelectedConversation(null)}\n              className=\"lg:hidden p-2 hover:bg-primary-800/50 rounded-full transition-colors\"\n            >\n              <ArrowLeft className=\"w-5 h-5 text-primary-300\" />\n            </button>\n            \n            <div className=\"w-10 h-10 bg-primary-800/50 rounded-full flex items-center justify-center\">\n              {selectedConversationUser.avatar ? (\n                <img\n                  src={selectedConversationUser.avatar}\n                  alt={selectedConversationUser.username}\n                  className=\"w-full h-full object-cover rounded-full\"\n                />\n              ) : (\n                <User className=\"w-5 h-5 text-primary-300\" />\n              )}\n            </div>\n            \n            <div>\n              <h3 className=\"font-semibold text-primary-100\">\n                @{selectedConversationUser.username}\n              </h3>\n              {typingUsersInConversation.length > 0 && (\n                <p className=\"text-sm text-blue-400\">typing...</p>\n              )}\n            </div>\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            <button className=\"p-2 hover:bg-primary-800/50 rounded-full transition-colors\">\n              <Phone className=\"w-5 h-5 text-primary-300\" />\n            </button>\n            <button className=\"p-2 hover:bg-primary-800/50 rounded-full transition-colors\">\n              <Video className=\"w-5 h-5 text-primary-300\" />\n            </button>\n            <button className=\"p-2 hover:bg-primary-800/50 rounded-full transition-colors\">\n              <Info className=\"w-5 h-5 text-primary-300\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Messages Area - Constrained scrollable container */}\n        <div \n          ref={messagesContainerRef}\n          className=\"flex-1 min-h-0 max-h-full overflow-y-auto overflow-x-hidden scrollbar-hide messages-container\"\n          style={{ \n            scrollbarWidth: 'none', \n            msOverflowStyle: 'none',\n            height: 'calc(100vh - 200px)' // Explicit height constraint\n          }}\n          onScroll={handleScroll}\n        >\n          {conversationMessages.length === 0 ? (\n            <div className=\"h-full flex items-center justify-center p-4\">\n              <div className=\"text-center\">\n                <p className=\"text-primary-300\">No messages yet</p>\n                <p className=\"text-sm text-primary-400 mt-1\">Send a message to start the conversation</p>\n              </div>\n            </div>\n          ) : (\n            <div \n              style={{ \n                height: totalHeight, \n                position: 'relative',\n                minHeight: '100%'\n              }}\n            >\n              <div \n                style={{ \n                  transform: `translateY(${offsetY}px)`,\n                  position: 'relative'\n                }}\n              >\n                {visibleMessages.map((message, index) => {\n                  const actualIndex = conversationMessages.findIndex(m => m.id === message.id);\n                  \n                  // Handle populated user objects\n                  const messageSenderId = typeof message.senderId === 'string' \n                    ? message.senderId \n                    : (message.senderId as any)?.id || (message.senderId as any)?._id;\n                  const prevMessageSenderId = actualIndex > 0 \n                    ? (typeof conversationMessages[actualIndex - 1].senderId === 'string' \n                        ? conversationMessages[actualIndex - 1].senderId \n                        : (conversationMessages[actualIndex - 1].senderId as any)?.id || (conversationMessages[actualIndex - 1].senderId as any)?._id)\n                    : null;\n                  const nextMessageSenderId = actualIndex < conversationMessages.length - 1 \n                    ? (typeof conversationMessages[actualIndex + 1].senderId === 'string' \n                        ? conversationMessages[actualIndex + 1].senderId \n                        : (conversationMessages[actualIndex + 1].senderId as any)?.id || (conversationMessages[actualIndex + 1].senderId as any)?._id)\n                    : null;\n\n                  const isOwn = messageSenderId === state.currentUser?.id;\n                  const showAvatar = actualIndex === 0 || prevMessageSenderId !== messageSenderId;\n                  const isLastInGroup = actualIndex === conversationMessages.length - 1 || nextMessageSenderId !== messageSenderId;\n                  \n                  return (\n                    <div\n                      key={message.id}\n                      className={`flex p-4 ${isOwn ? 'justify-end' : 'justify-start'}`}\n                      style={{ minHeight: MESSAGE_HEIGHT }}\n                    >\n                      <div className={`flex items-end space-x-2 max-w-xs lg:max-w-md ${isOwn ? 'flex-row-reverse space-x-reverse' : ''}`}>\n                        {/* Avatar */}\n                        <div className=\"w-8 h-8 flex-shrink-0\">\n                          {showAvatar && !isOwn && (\n                            <div className=\"w-8 h-8 bg-primary-800/50 rounded-full flex items-center justify-center\">\n                              {selectedConversationUser.avatar ? (\n                                <img\n                                  src={selectedConversationUser.avatar}\n                                  alt={selectedConversationUser.username}\n                                  className=\"w-full h-full object-cover rounded-full\"\n                                />\n                              ) : (\n                                <User className=\"w-4 h-4 text-primary-300\" />\n                              )}\n                            </div>\n                          )}\n                        </div>\n                        \n                        {/* Message Bubble */}\n                        <div\n                          className={`px-4 py-2 rounded-2xl ${\n                            isOwn\n                              ? 'bg-blue-600 text-white'\n                              : 'bg-primary-700/50 text-primary-100'\n                          } ${\n                            isLastInGroup ? '' : 'mb-1'\n                          }`}\n                        >\n                          <p className=\"text-sm whitespace-pre-wrap break-words\">{message.content}</p>\n                          \n                          {/* Message metadata */}\n                          <div className={`flex items-center justify-end mt-1 space-x-1 ${\n                            isOwn ? 'text-blue-200' : 'text-primary-400'\n                          }`}>\n                            <span className=\"text-xs\">\n                              {formatMessageTime(message.timestamp)}\n                            </span>\n                            {isOwn && (\n                              <div className=\"flex items-center\">\n                                {message.read ? (\n                                  <CheckCheck className=\"w-3 h-3\" />\n                                ) : (\n                                  <Check className=\"w-3 h-3\" />\n                                )}\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  );\n                })}\n                \n                {/* Typing Indicator */}\n                {typingUsersInConversation.length > 0 && (\n                  <div className=\"flex items-end space-x-2 p-4\">\n                    <div className=\"w-8 h-8 bg-primary-800/50 rounded-full flex items-center justify-center\">\n                      <User className=\"w-4 h-4 text-primary-300\" />\n                    </div>\n                    <div className=\"bg-primary-700/50 px-4 py-2 rounded-2xl\">\n                      <div className=\"flex space-x-1\">\n                        <div className=\"w-2 h-2 bg-primary-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                        <div className=\"w-2 h-2 bg-primary-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                        <div className=\"w-2 h-2 bg-primary-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n              <div ref={messagesEndRef} />\n            </div>\n          )}\n        </div>\n\n        {/* Message Input - Fixed height */}\n        <div className=\"flex-none h-auto p-4 border-t border-primary-700/30 bg-primary-900/95 backdrop-blur-sm z-20\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"flex-1\">\n              <textarea\n                value={messageText}\n                onChange={(e) => handleTyping(e.target.value)}\n                onKeyPress={handleKeyPress}\n                placeholder=\"Type a message...\"\n                className=\"message-input w-full px-4 py-3 bg-primary-800/50 border border-primary-700/30 rounded-xl text-primary-100 placeholder-primary-400 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all\"\n                rows={1}\n                disabled={loading}\n                style={{ \n                  minHeight: '48px',\n                  maxHeight: '120px',\n                  lineHeight: '1.5',\n                  paddingTop: '12px',\n                  paddingBottom: '12px'\n                }}\n                onInput={(e) => {\n                  const target = e.target as HTMLTextAreaElement;\n                  target.style.height = '48px';\n                  target.style.height = Math.min(target.scrollHeight, 120) + 'px';\n                }}\n              />\n            </div>\n            <button\n              onClick={handleSendMessage}\n              disabled={!messageText.trim() || loading}\n              className={`p-3 rounded-xl transition-all flex-shrink-0 ${\n                messageText.trim() && !loading\n                  ? 'bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-blue-500/25'\n                  : 'bg-primary-700/50 text-primary-400 cursor-not-allowed'\n              }`}\n            >\n              <Send className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"absolute inset-0 bg-gradient-to-br from-primary-900 via-primary-900 to-primary-800 text-primary-100 overflow-hidden\">\n      <div className=\"h-full flex messages-view\">\n        {/* Conversations Sidebar */}\n        <div className={`${\n          selectedConversation ? 'hidden lg:flex' : 'flex'\n        } w-full lg:w-1/3 xl:w-1/4 flex-col border-r border-primary-700/30 bg-primary-900/50 backdrop-blur-sm`}>\n          {/* Sidebar Header */}\n          <div className=\"flex-none h-16 px-4 py-3 border-b border-primary-700/30 flex items-center justify-between\">\n            <h2 className=\"text-lg font-semibold text-primary-100 flex items-center\">\n              <MessageCircle className=\"w-5 h-5 mr-2 text-primary-400\" />\n              Messages\n            </h2>\n            <button className=\"p-2 hover:bg-primary-800/50 rounded-full transition-colors\">\n              <Search className=\"w-5 h-5 text-primary-300\" />\n            </button>\n          </div>\n\n          {/* Conversations List */}\n          <div className=\"flex-1 min-h-0 overflow-y-auto scrollbar-hide\">\n            {loading ? (\n              <div className=\"p-4\">\n                <div className=\"animate-pulse space-y-3\">\n                  {[...Array(5)].map((_, i) => (\n                    <div key={i} className=\"flex items-center space-x-3 p-3\">\n                      <div className=\"w-10 h-10 bg-primary-700 rounded-full\"></div>\n                      <div className=\"flex-1\">\n                        <div className=\"h-4 bg-primary-700 rounded w-3/4 mb-2\"></div>\n                        <div className=\"h-3 bg-primary-700 rounded w-1/2\"></div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            ) : conversations.length === 0 ? (\n              <div className=\"p-4 text-center\">\n                <MessageCircle className=\"w-12 h-12 mx-auto mb-3 text-primary-400\" />\n                <p className=\"text-primary-300\">No conversations yet</p>\n                <p className=\"text-sm text-primary-400 mt-1\">Start a conversation to see it here</p>\n              </div>\n            ) : (\n              <div className=\"p-2\">\n                {conversations.map((conversation) => {\n                  const otherUserId = conversation.participants.find(p => p !== state.currentUser?.id);\n                  if (!otherUserId) return null;\n\n                  const otherUserData = state.users.find(u => u.id === otherUserId);\n                  if (!otherUserData) return null;\n\n                  const lastMessage = conversation.lastMessage;\n                  const isSelected = selectedConversation === conversation.id;\n                  const hasUnread = conversation.unreadCount > 0;\n\n                  return (\n                    <button\n                      key={conversation.id}\n                      onClick={() => handleConversationSelect(conversation.id)}\n                      className={`w-full p-3 rounded-lg transition-all text-left hover:bg-primary-800/30 ${\n                        isSelected ? 'bg-primary-800/50 border-l-2 border-blue-500' : ''\n                      }`}\n                    >\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"relative\">\n                          <div className=\"w-10 h-10 bg-primary-800/50 rounded-full flex items-center justify-center\">\n                            {otherUserData.avatar ? (\n                              <img\n                                src={otherUserData.avatar}\n                                alt={otherUserData.username}\n                                className=\"w-full h-full object-cover rounded-full\"\n                              />\n                            ) : (\n                              <User className=\"w-5 h-5 text-primary-300\" />\n                            )}\n                          </div>\n                          {hasUnread && (\n                            <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-blue-600 rounded-full flex items-center justify-center\">\n                              <span className=\"text-xs text-white font-medium\">\n                                {conversation.unreadCount > 9 ? '9+' : conversation.unreadCount}\n                              </span>\n                            </div>\n                          )}\n                        </div>\n                        \n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center justify-between mb-1\">\n                            <h3 className={`font-medium truncate ${\n                              hasUnread ? 'text-primary-100' : 'text-primary-200'\n                            }`}>\n                              @{otherUserData.username}\n                            </h3>\n                            {lastMessage && (\n                              <span className=\"text-xs text-primary-400 flex-shrink-0 ml-2\">\n                                {formatMessageTime(lastMessage.timestamp)}\n                              </span>\n                            )}\n                          </div>\n                          \n                          {lastMessage && (\n                            <p className={`text-sm truncate ${\n                              hasUnread ? 'text-primary-300 font-medium' : 'text-primary-400'\n                            }`}>\n                              {lastMessage.senderId === state.currentUser?.id ? 'You: ' : ''}\n                              {lastMessage.content}\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    </button>\n                  );\n                })}\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Chat Interface */}\n        <div className={`${\n          selectedConversation ? 'flex' : 'hidden lg:flex'\n        } flex-1 flex flex-col min-h-0 max-h-full overflow-hidden`}>\n          {renderChatInterface()}\n        </div>\n      </div>\n    </div>\n  );\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
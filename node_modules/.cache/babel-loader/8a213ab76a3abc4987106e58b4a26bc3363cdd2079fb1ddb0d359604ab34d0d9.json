{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\thato\\\\Downloads\\\\car-app\\\\src\\\\components\\\\messages\\\\MessagesView.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\nimport { motion } from 'framer-motion';\nimport { MessageCircle, Search, Send, User, ArrowLeft, Check, CheckCheck, Phone, Video, Info, Clock } from 'lucide-react';\nimport { useApp } from '../../context/AppContext.tsx';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport function MessagesView() {\n  _s();\n  var _state$currentUser5, _state$currentUser7, _state$currentUser11, _state$currentUser13;\n  const {\n    state,\n    sendMessage,\n    markMessagesAsRead\n  } = useApp();\n  const [selectedConversation, setSelectedConversation] = useState(null);\n  const [messageText, setMessageText] = useState('');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [typingUsers, setTypingUsers] = useState([]);\n  const [isTyping, setIsTyping] = useState(false);\n  const [pendingMessages, setPendingMessages] = useState([]);\n  const messagesEndRef = useRef(null);\n  const typingTimeoutRef = useRef();\n  const textareaRef = useRef(null);\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    // Use setTimeout to ensure DOM has been updated before scrolling\n    const timeoutId = setTimeout(() => {\n      scrollToBottom();\n    }, 100);\n    return () => clearTimeout(timeoutId);\n  }, [state.messages, selectedConversation, pendingMessages]);\n\n  // Scroll to bottom when conversation is first selected\n  useEffect(() => {\n    if (selectedConversation) {\n      const timeoutId = setTimeout(() => {\n        scrollToBottom();\n      }, 200); // Slightly longer delay for conversation switch\n\n      return () => clearTimeout(timeoutId);\n    }\n  }, [selectedConversation]);\n\n  // Clean up typing indicators that are too old\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = Date.now();\n      setTypingUsers(prev => prev.filter(typing => now - typing.timestamp < 3000));\n    }, 1000);\n    return () => clearInterval(interval);\n  }, []);\n\n  // Debug logging for conversations\n  useEffect(() => {\n    var _state$conversations, _state$messages, _state$users, _state$conversations2;\n    console.log('ðŸ“ž MessagesView Debug:', {\n      conversationsCount: ((_state$conversations = state.conversations) === null || _state$conversations === void 0 ? void 0 : _state$conversations.length) || 0,\n      messagesCount: ((_state$messages = state.messages) === null || _state$messages === void 0 ? void 0 : _state$messages.length) || 0,\n      usersCount: ((_state$users = state.users) === null || _state$users === void 0 ? void 0 : _state$users.length) || 0,\n      conversations: (_state$conversations2 = state.conversations) === null || _state$conversations2 === void 0 ? void 0 : _state$conversations2.slice(0, 3).map(c => {\n        var _c$lastMessage, _c$lastMessage$conten;\n        return {\n          id: c.id,\n          participants: c.participants,\n          otherUser: c.otherUser ? {\n            id: c.otherUser.id,\n            username: c.otherUser.username\n          } : null,\n          lastMessage: (_c$lastMessage = c.lastMessage) === null || _c$lastMessage === void 0 ? void 0 : (_c$lastMessage$conten = _c$lastMessage.content) === null || _c$lastMessage$conten === void 0 ? void 0 : _c$lastMessage$conten.substring(0, 30)\n        };\n      })\n    });\n  }, [state.conversations, state.messages, state.users]);\n  const scrollToBottom = () => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({\n        behavior: 'smooth',\n        block: 'end',\n        inline: 'nearest'\n      });\n    }\n  };\n\n  // Use conversations from state (loaded from API) with fallback to creating from messages\n  const conversations = useMemo(() => {\n    // If we have conversations from the API, use those\n    if (state.conversations && state.conversations.length > 0) {\n      console.log('ðŸ“ž Using conversations from API:', state.conversations.length);\n      return state.conversations.sort((a, b) => {\n        var _b$lastMessage, _a$lastMessage;\n        return new Date(b.updatedAt || ((_b$lastMessage = b.lastMessage) === null || _b$lastMessage === void 0 ? void 0 : _b$lastMessage.timestamp) || 0).getTime() - new Date(a.updatedAt || ((_a$lastMessage = a.lastMessage) === null || _a$lastMessage === void 0 ? void 0 : _a$lastMessage.timestamp) || 0).getTime();\n      });\n    }\n\n    // Fallback: Create conversations from messages if API conversations aren't available\n    console.log('ðŸ“ž Fallback: Creating conversations from messages');\n    const convMap = new Map();\n    state.messages.forEach(message => {\n      var _state$currentUser, _state$currentUser2;\n      const otherUserId = message.senderId === ((_state$currentUser = state.currentUser) === null || _state$currentUser === void 0 ? void 0 : _state$currentUser.id) ? message.receiverId : message.senderId;\n      const conversationId = [(_state$currentUser2 = state.currentUser) === null || _state$currentUser2 === void 0 ? void 0 : _state$currentUser2.id, otherUserId].sort().join('-');\n      if (!convMap.has(conversationId)) {\n        var _state$currentUser3;\n        convMap.set(conversationId, {\n          id: conversationId,\n          participants: [(_state$currentUser3 = state.currentUser) === null || _state$currentUser3 === void 0 ? void 0 : _state$currentUser3.id, otherUserId],\n          lastMessage: message,\n          unreadCount: 0,\n          updatedAt: message.timestamp\n        });\n      } else {\n        const existing = convMap.get(conversationId);\n        if (new Date(message.timestamp) > new Date(existing.lastMessage.timestamp)) {\n          existing.lastMessage = message;\n          existing.updatedAt = message.timestamp;\n        }\n      }\n    });\n\n    // Calculate unread counts\n    convMap.forEach(conversation => {\n      const unreadMessages = state.messages.filter(msg => {\n        var _state$currentUser4;\n        return msg.receiverId === ((_state$currentUser4 = state.currentUser) === null || _state$currentUser4 === void 0 ? void 0 : _state$currentUser4.id) && !msg.read && (msg.senderId === conversation.participants[0] || msg.senderId === conversation.participants[1]);\n      });\n      conversation.unreadCount = unreadMessages.length;\n    });\n    return Array.from(convMap.values()).sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n  }, [state.conversations, state.messages, (_state$currentUser5 = state.currentUser) === null || _state$currentUser5 === void 0 ? void 0 : _state$currentUser5.id, state.users]);\n\n  // Filter conversations based on search\n  const filteredConversations = useMemo(() => {\n    if (!searchTerm) return conversations;\n    return conversations.filter(conversation => {\n      var _otherUser$username;\n      // For API conversations, use embedded otherUser data; for fallback conversations, find in state.users\n      const otherUser = conversation.otherUser || (() => {\n        const otherUserId = conversation.participants.find(p => {\n          var _state$currentUser6;\n          return p !== ((_state$currentUser6 = state.currentUser) === null || _state$currentUser6 === void 0 ? void 0 : _state$currentUser6.id);\n        });\n        return state.users.find(u => u.id === otherUserId);\n      })();\n      return otherUser === null || otherUser === void 0 ? void 0 : (_otherUser$username = otherUser.username) === null || _otherUser$username === void 0 ? void 0 : _otherUser$username.toLowerCase().includes(searchTerm.toLowerCase());\n    });\n  }, [conversations, searchTerm, state.users, (_state$currentUser7 = state.currentUser) === null || _state$currentUser7 === void 0 ? void 0 : _state$currentUser7.id]);\n\n  // Get messages for selected conversation (including pending messages)\n  const conversationMessages = useMemo(() => {\n    var _state$currentUser9;\n    if (!selectedConversation) return [];\n    const conversation = conversations.find(c => c.id === selectedConversation);\n    if (!conversation) {\n      console.log('ðŸ” No conversation found for ID:', selectedConversation);\n      return [];\n    }\n    console.log('ðŸ” Filtering messages for conversation:', {\n      conversationId: selectedConversation,\n      participants: conversation.participants,\n      otherUser: conversation.otherUser,\n      totalMessages: state.messages.length\n    });\n\n    // For API conversations, we have otherUser data directly\n    let otherUserId;\n    if (conversation.otherUser) {\n      otherUserId = conversation.otherUser.id;\n    } else {\n      // Fallback for generated conversations\n      otherUserId = conversation.participants.find(p => {\n        var _state$currentUser8;\n        return p !== ((_state$currentUser8 = state.currentUser) === null || _state$currentUser8 === void 0 ? void 0 : _state$currentUser8.id);\n      }) || '';\n    }\n    console.log('ðŸ” Other user ID:', otherUserId, 'Current user ID:', (_state$currentUser9 = state.currentUser) === null || _state$currentUser9 === void 0 ? void 0 : _state$currentUser9.id);\n    const filteredMessages = state.messages.filter(msg => {\n      var _state$currentUser0, _state$currentUser1;\n      // Debug: Log the actual message structure\n      if (state.messages.indexOf(msg) < 3) {\n        console.log('ðŸ” Sample message structure:', {\n          id: msg.id,\n          senderId: msg.senderId,\n          receiverId: msg.receiverId,\n          senderIdType: typeof msg.senderId,\n          receiverIdType: typeof msg.receiverId,\n          content: msg.content.substring(0, 20)\n        });\n      }\n\n      // Ensure we're comparing strings\n      const messageSenderId = typeof msg.senderId === 'object' ? msg.senderId.id : msg.senderId;\n      const messageReceiverId = typeof msg.receiverId === 'object' ? msg.receiverId.id : msg.receiverId;\n\n      // Direct conversation between current user and other user\n      const matches = messageSenderId === ((_state$currentUser0 = state.currentUser) === null || _state$currentUser0 === void 0 ? void 0 : _state$currentUser0.id) && messageReceiverId === otherUserId || messageSenderId === otherUserId && messageReceiverId === ((_state$currentUser1 = state.currentUser) === null || _state$currentUser1 === void 0 ? void 0 : _state$currentUser1.id);\n      if (matches) {\n        console.log('ðŸ” Message matches:', {\n          id: msg.id,\n          senderId: messageSenderId,\n          receiverId: messageReceiverId,\n          content: msg.content.substring(0, 30)\n        });\n      }\n      return matches;\n    }).sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n\n    // Add pending messages for this conversation, but exclude ones that have real counterparts\n    const conversationPendingMessages = pendingMessages.filter(msg => {\n      // Only show pending messages for this conversation\n      if (msg.receiverId !== otherUserId) return false;\n\n      // Don't show pending messages if a real message with similar content and timestamp exists\n      const hasRealCounterpart = filteredMessages.some(realMsg => {\n        var _state$currentUser10;\n        const realMsgSenderId = typeof realMsg.senderId === 'object' ? realMsg.senderId.id : realMsg.senderId;\n        return realMsgSenderId === ((_state$currentUser10 = state.currentUser) === null || _state$currentUser10 === void 0 ? void 0 : _state$currentUser10.id) && realMsg.content === msg.content && Math.abs(new Date(realMsg.timestamp).getTime() - new Date(msg.timestamp).getTime()) < 5000; // Within 5 seconds\n      });\n      return !hasRealCounterpart;\n    }).map(msg => ({\n      ...msg,\n      read: false,\n      isPending: true\n    }));\n\n    // Combine and sort all messages\n    const allMessages = [...filteredMessages, ...conversationPendingMessages].sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n    console.log('ðŸ” Filtered messages count:', filteredMessages.length, 'Pending:', conversationPendingMessages.length);\n    return allMessages;\n  }, [selectedConversation, conversations, state.messages, (_state$currentUser11 = state.currentUser) === null || _state$currentUser11 === void 0 ? void 0 : _state$currentUser11.id, pendingMessages]);\n\n  // Get other user in selected conversation\n  const selectedConversationUser = useMemo(() => {\n    if (!selectedConversation) return null;\n    const conversation = conversations.find(c => c.id === selectedConversation);\n    if (!conversation) return null;\n\n    // For API conversations, use embedded otherUser data; for fallback conversations, find in state.users\n    const otherUser = conversation.otherUser || (() => {\n      const otherUserId = conversation.participants.find(p => {\n        var _state$currentUser12;\n        return p !== ((_state$currentUser12 = state.currentUser) === null || _state$currentUser12 === void 0 ? void 0 : _state$currentUser12.id);\n      });\n      return state.users.find(u => u.id === otherUserId);\n    })();\n    return otherUser || null;\n  }, [selectedConversation, conversations, state.users, (_state$currentUser13 = state.currentUser) === null || _state$currentUser13 === void 0 ? void 0 : _state$currentUser13.id]);\n  const handleSendMessage = async () => {\n    if (!messageText.trim() || !selectedConversationUser || loading) return;\n    const tempMessage = {\n      id: `temp-${Date.now()}`,\n      content: messageText.trim(),\n      timestamp: new Date().toISOString(),\n      senderId: state.currentUser.id,\n      receiverId: selectedConversationUser.id,\n      status: 'sending'\n    };\n\n    // Add to pending messages immediately\n    setPendingMessages(prev => [...prev, tempMessage]);\n    setMessageText('');\n    setIsTyping(false);\n\n    // Auto-resize textarea back to single line\n    if (textareaRef.current) {\n      textareaRef.current.style.height = '40px';\n    }\n    setLoading(true);\n    try {\n      await sendMessage({\n        senderId: state.currentUser.id,\n        receiverId: selectedConversationUser.id,\n        content: tempMessage.content\n      });\n\n      // Mark as sent\n      setPendingMessages(prev => prev.map(msg => msg.id === tempMessage.id ? {\n        ...msg,\n        status: 'sent'\n      } : msg));\n\n      // Remove from pending after a short delay to show \"sent\" status\n      setTimeout(() => {\n        setPendingMessages(prev => prev.filter(msg => msg.id !== tempMessage.id));\n      }, 1000);\n    } catch (error) {\n      console.error('Error sending message:', error);\n      // Mark as failed\n      setPendingMessages(prev => prev.map(msg => msg.id === tempMessage.id ? {\n        ...msg,\n        status: 'failed'\n      } : msg));\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleKeyPress = e => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n  const handleTyping = value => {\n    setMessageText(value);\n\n    // Auto-resize textarea\n    if (textareaRef.current) {\n      textareaRef.current.style.height = '40px';\n      textareaRef.current.style.height = `${Math.min(textareaRef.current.scrollHeight, 120)}px`;\n    }\n    if (value.trim() && !isTyping) {\n      setIsTyping(true);\n      // In a real app, you'd emit typing indicator to other users via WebSocket\n    }\n\n    // Clear typing indicator after 2 seconds of no typing\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n    typingTimeoutRef.current = setTimeout(() => {\n      setIsTyping(false);\n    }, 2000);\n  };\n  const handleConversationSelect = async conversationId => {\n    console.log('ðŸ” Selecting conversation:', conversationId);\n    const conversation = conversations.find(c => c.id === conversationId);\n    console.log('ðŸ” Found conversation:', conversation ? {\n      id: conversation.id,\n      participants: conversation.participants,\n      otherUser: conversation.otherUser ? {\n        id: conversation.otherUser.id,\n        username: conversation.otherUser.username\n      } : null\n    } : 'NOT FOUND');\n    setSelectedConversation(conversationId);\n\n    // Mark messages as read\n    if (conversation && conversation.unreadCount > 0) {\n      try {\n        await markMessagesAsRead(conversationId);\n      } catch (error) {\n        console.error('Error marking messages as read:', error);\n      }\n    }\n  };\n  const formatTime = timestamp => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffInHours = (now.getTime() - date.getTime()) / (1000 * 60 * 60);\n    if (diffInHours < 24) {\n      return date.toLocaleTimeString([], {\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    } else if (diffInHours < 168) {\n      // 7 days\n      return date.toLocaleDateString([], {\n        weekday: 'short'\n      });\n    } else {\n      return date.toLocaleDateString([], {\n        month: 'short',\n        day: 'numeric'\n      });\n    }\n  };\n  const formatMessageTime = timestamp => {\n    return new Date(timestamp).toLocaleTimeString([], {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n  const renderConversationsList = () => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"w-full lg:w-96 border-r border-primary-700/30 flex flex-col\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-4 border-b border-primary-700/30\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-xl font-bold text-primary-100 mb-4\",\n        children: \"Messages\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 427,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative\",\n        children: [/*#__PURE__*/_jsxDEV(Search, {\n          className: \"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-primary-400\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Search conversations...\",\n          value: searchTerm,\n          onChange: e => setSearchTerm(e.target.value),\n          className: \"input-field pl-10 text-sm\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 430,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 overflow-y-auto\",\n      children: !state.conversations || state.conversations.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4 text-center\",\n        children: [/*#__PURE__*/_jsxDEV(MessageCircle, {\n          className: \"w-12 h-12 mx-auto mb-4 text-primary-400\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 446,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-primary-300\",\n          children: !state.conversations ? 'Loading conversations...' : 'No conversations yet'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-sm text-primary-400 mt-1\",\n          children: !state.conversations ? 'Please wait while we load your messages' : 'Start trading to begin messaging with other users'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 450,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 445,\n        columnNumber: 11\n      }, this) : filteredConversations.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4 text-center\",\n        children: [/*#__PURE__*/_jsxDEV(MessageCircle, {\n          className: \"w-12 h-12 mx-auto mb-4 text-primary-400\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 459,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-primary-300\",\n          children: \"No conversations match your search\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 460,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-sm text-primary-400 mt-1\",\n          children: \"Try adjusting your search terms\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 461,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 458,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"space-y-1 p-2\",\n        children: filteredConversations.map(conversation => {\n          var _state$currentUser15;\n          // For API conversations, use embedded otherUser data; for fallback conversations, find in state.users\n          const otherUser = conversation.otherUser || (() => {\n            const otherUserId = conversation.participants.find(p => {\n              var _state$currentUser14;\n              return p !== ((_state$currentUser14 = state.currentUser) === null || _state$currentUser14 === void 0 ? void 0 : _state$currentUser14.id);\n            });\n            return state.users.find(u => u.id === otherUserId);\n          })();\n          const isSelected = selectedConversation === conversation.id;\n          return /*#__PURE__*/_jsxDEV(motion.div, {\n            whileHover: {\n              scale: 1.02\n            },\n            whileTap: {\n              scale: 0.98\n            },\n            onClick: () => handleConversationSelect(conversation.id),\n            className: `p-3 rounded-lg cursor-pointer transition-all ${isSelected ? 'bg-primary-600/30 border border-primary-500/50' : 'hover:bg-primary-800/30'}`,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"relative\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"w-12 h-12 bg-primary-800/50 rounded-full flex items-center justify-center\",\n                  children: otherUser !== null && otherUser !== void 0 && otherUser.avatar ? /*#__PURE__*/_jsxDEV(\"img\", {\n                    src: otherUser.avatar,\n                    alt: otherUser.username,\n                    className: \"w-full h-full object-cover rounded-full\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 492,\n                    columnNumber: 27\n                  }, this) : /*#__PURE__*/_jsxDEV(User, {\n                    className: \"w-6 h-6 text-primary-300\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 498,\n                    columnNumber: 27\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 490,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 489,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex-1 min-w-0\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center justify-between\",\n                  children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                    className: \"font-medium text-primary-100 truncate\",\n                    children: [\"@\", (otherUser === null || otherUser === void 0 ? void 0 : otherUser.username) || 'Unknown']\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 507,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-xs text-primary-400\",\n                    children: formatTime(conversation.lastMessage.timestamp)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 510,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 506,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center justify-between mt-1\",\n                  children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                    className: \"text-sm text-primary-300 truncate\",\n                    children: [conversation.lastMessage.senderId === ((_state$currentUser15 = state.currentUser) === null || _state$currentUser15 === void 0 ? void 0 : _state$currentUser15.id) && 'You: ', conversation.lastMessage.content]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 516,\n                    columnNumber: 25\n                  }, this), conversation.unreadCount > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"bg-blue-500 text-white text-xs px-2 py-1 rounded-full min-w-[20px] text-center\",\n                    children: conversation.unreadCount > 99 ? '99+' : conversation.unreadCount\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 521,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 515,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 505,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 487,\n              columnNumber: 19\n            }, this)\n          }, conversation.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 476,\n            columnNumber: 17\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 466,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 443,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 424,\n    columnNumber: 5\n  }, this);\n  const renderChatInterface = () => {\n    if (!selectedConversation || !selectedConversationUser) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 flex items-center justify-center\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center\",\n          children: [/*#__PURE__*/_jsxDEV(MessageCircle, {\n            className: \"w-16 h-16 mx-auto mb-4 text-primary-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 542,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-xl font-semibold text-primary-100 mb-2\",\n            children: \"Select a conversation\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 543,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-primary-300\",\n            children: \"Choose a conversation to start messaging\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 544,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 541,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 540,\n        columnNumber: 9\n      }, this);\n    }\n    const typingUsersInConversation = typingUsers.filter(t => t.conversationId === selectedConversation);\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 flex flex-col h-full relative\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-shrink-0 p-4 border-b border-primary-700/30 flex items-center justify-between bg-primary-900/50 z-10\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setSelectedConversation(null),\n            className: \"lg:hidden p-2 hover:bg-primary-800/50 rounded-full transition-colors\",\n            children: /*#__PURE__*/_jsxDEV(ArrowLeft, {\n              className: \"w-5 h-5 text-primary-300\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 561,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 557,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-10 h-10 bg-primary-800/50 rounded-full flex items-center justify-center\",\n            children: selectedConversationUser.avatar ? /*#__PURE__*/_jsxDEV(\"img\", {\n              src: selectedConversationUser.avatar,\n              alt: selectedConversationUser.username,\n              className: \"w-full h-full object-cover rounded-full\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 566,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(User, {\n              className: \"w-5 h-5 text-primary-300\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 572,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 564,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              className: \"font-semibold text-primary-100\",\n              children: [\"@\", selectedConversationUser.username]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 577,\n              columnNumber: 15\n            }, this), typingUsersInConversation.length > 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-sm text-blue-400\",\n              children: \"typing...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 581,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 576,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 556,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"p-2 hover:bg-primary-800/50 rounded-full transition-colors\",\n            children: /*#__PURE__*/_jsxDEV(Phone, {\n              className: \"w-5 h-5 text-primary-300\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 588,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 587,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"p-2 hover:bg-primary-800/50 rounded-full transition-colors\",\n            children: /*#__PURE__*/_jsxDEV(Video, {\n              className: \"w-5 h-5 text-primary-300\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 591,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 590,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"p-2 hover:bg-primary-800/50 rounded-full transition-colors\",\n            children: /*#__PURE__*/_jsxDEV(Info, {\n              className: \"w-5 h-5 text-primary-300\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 594,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 593,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 586,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 555,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 overflow-hidden pb-20\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"h-full overflow-y-auto px-4 py-4 messages-scrollbar\",\n          children: conversationMessages.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"h-full flex items-center justify-center\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-center\",\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-primary-300\",\n                children: \"No messages yet\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 605,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-sm text-primary-400 mt-1\",\n                children: \"Send a message to start the conversation\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 606,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 604,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 603,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"space-y-3\",\n            children: [conversationMessages.map((message, index) => {\n              var _state$currentUser16;\n              // Ensure we're comparing the correct sender ID (handle both string and object)\n              const messageSenderId = typeof message.senderId === 'object' ? message.senderId.id : message.senderId;\n              const isOwn = messageSenderId === ((_state$currentUser16 = state.currentUser) === null || _state$currentUser16 === void 0 ? void 0 : _state$currentUser16.id);\n              const isPending = message.isPending;\n              const pendingStatus = isPending ? message.status : null;\n\n              // Debug logging for first few messages\n              if (index < 3) {\n                var _state$currentUser17;\n                console.log('ðŸŽ¨ Message ownership check:', {\n                  messageId: message.id,\n                  originalSenderId: message.senderId,\n                  extractedSenderId: messageSenderId,\n                  currentUserId: (_state$currentUser17 = state.currentUser) === null || _state$currentUser17 === void 0 ? void 0 : _state$currentUser17.id,\n                  isOwn: isOwn,\n                  isPending: isPending,\n                  content: message.content.substring(0, 20)\n                });\n              }\n              const showAvatar = index === 0 || (() => {\n                const prevMessageSenderId = typeof conversationMessages[index - 1].senderId === 'object' ? conversationMessages[index - 1].senderId.id : conversationMessages[index - 1].senderId;\n                return prevMessageSenderId !== messageSenderId;\n              })();\n              const isLastInGroup = index === conversationMessages.length - 1 || (() => {\n                const nextMessageSenderId = typeof conversationMessages[index + 1].senderId === 'object' ? conversationMessages[index + 1].senderId.id : conversationMessages[index + 1].senderId;\n                return nextMessageSenderId !== messageSenderId;\n              })();\n              return /*#__PURE__*/_jsxDEV(motion.div, {\n                initial: {\n                  opacity: 0,\n                  y: 20\n                },\n                animate: {\n                  opacity: 1,\n                  y: 0\n                },\n                className: `flex ${isOwn ? 'justify-end' : 'justify-start'}`,\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: `flex items-end space-x-2 max-w-xs lg:max-w-md ${isOwn ? 'flex-row-reverse space-x-reverse' : ''}`,\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"w-8 h-8 flex-shrink-0\",\n                    children: showAvatar && !isOwn && /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"w-8 h-8 bg-primary-800/50 rounded-full flex items-center justify-center\",\n                      children: selectedConversationUser.avatar ? /*#__PURE__*/_jsxDEV(\"img\", {\n                        src: selectedConversationUser.avatar,\n                        alt: selectedConversationUser.username,\n                        className: \"w-full h-full object-cover rounded-full\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 658,\n                        columnNumber: 33\n                      }, this) : /*#__PURE__*/_jsxDEV(User, {\n                        className: \"w-4 h-4 text-primary-300\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 664,\n                        columnNumber: 33\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 656,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 654,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `px-4 py-2 rounded-2xl ${isOwn ? `bg-blue-600 text-white ${isPending && pendingStatus === 'sending' ? 'opacity-70' : ''} ${isPending && pendingStatus === 'failed' ? 'bg-red-600' : ''}` : 'bg-primary-700/50 text-primary-100'} ${isLastInGroup ? '' : 'mb-1'}`,\n                    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                      className: \"text-sm whitespace-pre-wrap\",\n                      children: message.content\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 680,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: `flex items-center justify-end mt-1 space-x-1 ${isOwn ? 'text-blue-200' : 'text-primary-400'}`,\n                      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"text-xs\",\n                        children: formatMessageTime(message.timestamp)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 686,\n                        columnNumber: 29\n                      }, this), isOwn && /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"flex items-center\",\n                        children: isPending ? pendingStatus === 'sending' ? /*#__PURE__*/_jsxDEV(Clock, {\n                          className: \"w-3 h-3 animate-spin\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 693,\n                          columnNumber: 37\n                        }, this) : pendingStatus === 'failed' ? /*#__PURE__*/_jsxDEV(\"span\", {\n                          className: \"text-xs text-red-200\",\n                          children: \"Failed\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 695,\n                          columnNumber: 37\n                        }, this) : /*#__PURE__*/_jsxDEV(Check, {\n                          className: \"w-3 h-3\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 697,\n                          columnNumber: 37\n                        }, this) : message.read ? /*#__PURE__*/_jsxDEV(CheckCheck, {\n                          className: \"w-3 h-3\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 700,\n                          columnNumber: 35\n                        }, this) : /*#__PURE__*/_jsxDEV(Check, {\n                          className: \"w-3 h-3\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 702,\n                          columnNumber: 35\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 690,\n                        columnNumber: 31\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 683,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 671,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 652,\n                  columnNumber: 23\n                }, this)\n              }, message.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 646,\n                columnNumber: 21\n              }, this);\n            }), typingUsersInConversation.length > 0 && /*#__PURE__*/_jsxDEV(motion.div, {\n              initial: {\n                opacity: 0,\n                y: 10\n              },\n              animate: {\n                opacity: 1,\n                y: 0\n              },\n              className: \"flex items-end space-x-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-8 h-8 bg-primary-800/50 rounded-full flex items-center justify-center\",\n                children: /*#__PURE__*/_jsxDEV(User, {\n                  className: \"w-4 h-4 text-primary-300\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 721,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 720,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"bg-primary-700/50 px-4 py-2 rounded-2xl\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex space-x-1\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"w-2 h-2 bg-primary-400 rounded-full animate-bounce\",\n                    style: {\n                      animationDelay: '0ms'\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 725,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"w-2 h-2 bg-primary-400 rounded-full animate-bounce\",\n                    style: {\n                      animationDelay: '150ms'\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 726,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"w-2 h-2 bg-primary-400 rounded-full animate-bounce\",\n                    style: {\n                      animationDelay: '300ms'\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 727,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 724,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 723,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 715,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              ref: messagesEndRef\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 733,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 610,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 601,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 600,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute bottom-0 left-0 right-0 p-4 border-t border-primary-700/30 bg-primary-900/95 backdrop-blur-sm z-20\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-3 max-w-4xl mx-auto\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1\",\n            children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n              ref: textareaRef,\n              value: messageText,\n              onChange: e => handleTyping(e.target.value),\n              onKeyPress: handleKeyPress,\n              placeholder: \"Type a message...\",\n              className: \"w-full px-4 py-3 bg-primary-800/50 border border-primary-600/30 rounded-2xl text-primary-100 placeholder-primary-400 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all scrollbar-none\",\n              style: {\n                minHeight: '48px',\n                maxHeight: '120px',\n                lineHeight: '1.5'\n              },\n              rows: 1,\n              disabled: loading\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 743,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 742,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleSendMessage,\n            disabled: !messageText.trim() || loading,\n            className: `w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 transition-all ${messageText.trim() && !loading ? 'bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-xl' : 'bg-primary-700/50 text-primary-400 cursor-not-allowed'}`,\n            children: /*#__PURE__*/_jsxDEV(Send, {\n              className: \"w-5 h-5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 768,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 759,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 741,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 740,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 553,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"h-full flex\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"lg:hidden w-full h-full\",\n      children: selectedConversation ? renderChatInterface() : renderConversationsList()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 779,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"hidden lg:flex w-full h-full\",\n      children: [renderConversationsList(), renderChatInterface()]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 784,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 777,\n    columnNumber: 5\n  }, this);\n}\n_s(MessagesView, \"kKnAfqFIqaT/XnUXyP0ZHWx/shc=\", false, function () {\n  return [useApp];\n});\n_c = MessagesView;\nvar _c;\n$RefreshReg$(_c, \"MessagesView\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useMemo","motion","MessageCircle","Search","Send","User","ArrowLeft","Check","CheckCheck","Phone","Video","Info","Clock","useApp","jsxDEV","_jsxDEV","MessagesView","_s","_state$currentUser5","_state$currentUser7","_state$currentUser11","_state$currentUser13","state","sendMessage","markMessagesAsRead","selectedConversation","setSelectedConversation","messageText","setMessageText","searchTerm","setSearchTerm","loading","setLoading","typingUsers","setTypingUsers","isTyping","setIsTyping","pendingMessages","setPendingMessages","messagesEndRef","typingTimeoutRef","textareaRef","timeoutId","setTimeout","scrollToBottom","clearTimeout","messages","interval","setInterval","now","Date","prev","filter","typing","timestamp","clearInterval","_state$conversations","_state$messages","_state$users","_state$conversations2","console","log","conversationsCount","conversations","length","messagesCount","usersCount","users","slice","map","c","_c$lastMessage","_c$lastMessage$conten","id","participants","otherUser","username","lastMessage","content","substring","current","scrollIntoView","behavior","block","inline","sort","a","b","_b$lastMessage","_a$lastMessage","updatedAt","getTime","convMap","Map","forEach","message","_state$currentUser","_state$currentUser2","otherUserId","senderId","currentUser","receiverId","conversationId","join","has","_state$currentUser3","set","unreadCount","existing","get","conversation","unreadMessages","msg","_state$currentUser4","read","Array","from","values","filteredConversations","_otherUser$username","find","p","_state$currentUser6","u","toLowerCase","includes","conversationMessages","_state$currentUser9","totalMessages","_state$currentUser8","filteredMessages","_state$currentUser0","_state$currentUser1","indexOf","senderIdType","receiverIdType","messageSenderId","messageReceiverId","matches","conversationPendingMessages","hasRealCounterpart","some","realMsg","_state$currentUser10","realMsgSenderId","Math","abs","isPending","allMessages","selectedConversationUser","_state$currentUser12","handleSendMessage","trim","tempMessage","toISOString","status","style","height","error","handleKeyPress","e","key","shiftKey","preventDefault","handleTyping","value","min","scrollHeight","handleConversationSelect","formatTime","date","diffInHours","toLocaleTimeString","hour","minute","toLocaleDateString","weekday","month","day","formatMessageTime","renderConversationsList","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","placeholder","onChange","target","_state$currentUser15","_state$currentUser14","isSelected","div","whileHover","scale","whileTap","onClick","avatar","src","alt","renderChatInterface","typingUsersInConversation","t","index","_state$currentUser16","isOwn","pendingStatus","_state$currentUser17","messageId","originalSenderId","extractedSenderId","currentUserId","showAvatar","prevMessageSenderId","isLastInGroup","nextMessageSenderId","initial","opacity","y","animate","animationDelay","ref","onKeyPress","minHeight","maxHeight","lineHeight","rows","disabled","_c","$RefreshReg$"],"sources":["C:/Users/thato/Downloads/car-app/src/components/messages/MessagesView.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  MessageCircle, \n  Search, \n  Send, \n  User, \n  ArrowLeft, \n  MoreVertical,\n  Check,\n  CheckCheck,\n  Phone,\n  Video,\n  Info,\n  Clock\n} from 'lucide-react';\nimport { useApp } from '../../context/AppContext.tsx';\nimport { Message, User as UserType, Conversation } from '../../types/index.ts';\n\ninterface TypingIndicator {\n  userId: string;\n  conversationId: string;\n  timestamp: number;\n}\n\ninterface PendingMessage {\n  id: string;\n  content: string;\n  timestamp: string;\n  senderId: string;\n  receiverId: string;\n  status: 'sending' | 'sent' | 'failed';\n}\n\nexport function MessagesView() {\n  const { state, sendMessage, markMessagesAsRead } = useApp();\n  const [selectedConversation, setSelectedConversation] = useState<string | null>(null);\n  const [messageText, setMessageText] = useState('');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [typingUsers, setTypingUsers] = useState<TypingIndicator[]>([]);\n  const [isTyping, setIsTyping] = useState(false);\n  const [pendingMessages, setPendingMessages] = useState<PendingMessage[]>([]);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const typingTimeoutRef = useRef<NodeJS.Timeout>();\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    // Use setTimeout to ensure DOM has been updated before scrolling\n    const timeoutId = setTimeout(() => {\n      scrollToBottom();\n    }, 100);\n\n    return () => clearTimeout(timeoutId);\n  }, [state.messages, selectedConversation, pendingMessages]);\n\n  // Scroll to bottom when conversation is first selected\n  useEffect(() => {\n    if (selectedConversation) {\n      const timeoutId = setTimeout(() => {\n        scrollToBottom();\n      }, 200); // Slightly longer delay for conversation switch\n\n      return () => clearTimeout(timeoutId);\n    }\n  }, [selectedConversation]);\n\n  // Clean up typing indicators that are too old\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = Date.now();\n      setTypingUsers(prev => prev.filter(typing => now - typing.timestamp < 3000));\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  // Debug logging for conversations\n  useEffect(() => {\n    console.log('ðŸ“ž MessagesView Debug:', {\n      conversationsCount: state.conversations?.length || 0,\n      messagesCount: state.messages?.length || 0,\n      usersCount: state.users?.length || 0,\n      conversations: state.conversations?.slice(0, 3).map(c => ({\n        id: c.id,\n        participants: c.participants,\n        otherUser: (c as any).otherUser ? {\n          id: (c as any).otherUser.id,\n          username: (c as any).otherUser.username\n        } : null,\n        lastMessage: c.lastMessage?.content?.substring(0, 30)\n      }))\n    });\n  }, [state.conversations, state.messages, state.users]);\n\n  const scrollToBottom = () => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ \n        behavior: 'smooth',\n        block: 'end',\n        inline: 'nearest'\n      });\n    }\n  };\n\n  // Use conversations from state (loaded from API) with fallback to creating from messages\n  const conversations = useMemo(() => {\n    // If we have conversations from the API, use those\n    if (state.conversations && state.conversations.length > 0) {\n      console.log('ðŸ“ž Using conversations from API:', state.conversations.length);\n      return state.conversations.sort((a, b) => \n        new Date(b.updatedAt || b.lastMessage?.timestamp || 0).getTime() - \n        new Date(a.updatedAt || a.lastMessage?.timestamp || 0).getTime()\n      );\n    }\n\n    // Fallback: Create conversations from messages if API conversations aren't available\n    console.log('ðŸ“ž Fallback: Creating conversations from messages');\n    const convMap = new Map<string, Conversation>();\n    \n    state.messages.forEach(message => {\n      const otherUserId = message.senderId === state.currentUser?.id \n        ? message.receiverId \n        : message.senderId;\n      \n      const conversationId = [state.currentUser?.id, otherUserId].sort().join('-');\n      \n      if (!convMap.has(conversationId)) {\n        convMap.set(conversationId, {\n          id: conversationId,\n          participants: [state.currentUser?.id!, otherUserId],\n          lastMessage: message,\n          unreadCount: 0,\n          updatedAt: message.timestamp\n        });\n      } else {\n        const existing = convMap.get(conversationId)!;\n        if (new Date(message.timestamp) > new Date(existing.lastMessage.timestamp)) {\n          existing.lastMessage = message;\n          existing.updatedAt = message.timestamp;\n        }\n      }\n    });\n\n    // Calculate unread counts\n    convMap.forEach(conversation => {\n      const unreadMessages = state.messages.filter(msg => \n        msg.receiverId === state.currentUser?.id &&\n        !msg.read &&\n        (msg.senderId === conversation.participants[0] || msg.senderId === conversation.participants[1])\n      );\n      conversation.unreadCount = unreadMessages.length;\n    });\n\n    return Array.from(convMap.values()).sort((a, b) => \n      new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime()\n    );\n  }, [state.conversations, state.messages, state.currentUser?.id, state.users]);\n\n  // Filter conversations based on search\n  const filteredConversations = useMemo(() => {\n    if (!searchTerm) return conversations;\n    \n    return conversations.filter(conversation => {\n      // For API conversations, use embedded otherUser data; for fallback conversations, find in state.users\n      const otherUser = (conversation as any).otherUser || (() => {\n        const otherUserId = conversation.participants.find(p => p !== state.currentUser?.id);\n        return state.users.find(u => u.id === otherUserId);\n      })();\n      \n      return otherUser?.username?.toLowerCase().includes(searchTerm.toLowerCase());\n    });\n  }, [conversations, searchTerm, state.users, state.currentUser?.id]);\n\n  // Get messages for selected conversation (including pending messages)\n  const conversationMessages = useMemo(() => {\n    if (!selectedConversation) return [];\n    \n    const conversation = conversations.find(c => c.id === selectedConversation);\n    if (!conversation) {\n      console.log('ðŸ” No conversation found for ID:', selectedConversation);\n      return [];\n    }\n    \n    console.log('ðŸ” Filtering messages for conversation:', {\n      conversationId: selectedConversation,\n      participants: conversation.participants,\n      otherUser: (conversation as any).otherUser,\n      totalMessages: state.messages.length\n    });\n    \n    // For API conversations, we have otherUser data directly\n    let otherUserId: string;\n    if ((conversation as any).otherUser) {\n      otherUserId = (conversation as any).otherUser.id;\n    } else {\n      // Fallback for generated conversations\n      otherUserId = conversation.participants.find(p => p !== state.currentUser?.id) || '';\n    }\n    \n    console.log('ðŸ” Other user ID:', otherUserId, 'Current user ID:', state.currentUser?.id);\n    \n    const filteredMessages = state.messages\n      .filter(msg => {\n        // Debug: Log the actual message structure\n        if (state.messages.indexOf(msg) < 3) {\n          console.log('ðŸ” Sample message structure:', {\n            id: msg.id,\n            senderId: msg.senderId,\n            receiverId: msg.receiverId,\n            senderIdType: typeof msg.senderId,\n            receiverIdType: typeof msg.receiverId,\n            content: msg.content.substring(0, 20)\n          });\n        }\n        \n        // Ensure we're comparing strings\n        const messageSenderId = typeof msg.senderId === 'object' ? (msg.senderId as any).id : msg.senderId;\n        const messageReceiverId = typeof msg.receiverId === 'object' ? (msg.receiverId as any).id : msg.receiverId;\n        \n        // Direct conversation between current user and other user\n        const matches = (\n          (messageSenderId === state.currentUser?.id && messageReceiverId === otherUserId) ||\n          (messageSenderId === otherUserId && messageReceiverId === state.currentUser?.id)\n        );\n        \n        if (matches) {\n          console.log('ðŸ” Message matches:', {\n            id: msg.id,\n            senderId: messageSenderId,\n            receiverId: messageReceiverId,\n            content: msg.content.substring(0, 30)\n          });\n        }\n        \n        return matches;\n      })\n      .sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n\n    // Add pending messages for this conversation, but exclude ones that have real counterparts\n    const conversationPendingMessages = pendingMessages\n      .filter(msg => {\n        // Only show pending messages for this conversation\n        if (msg.receiverId !== otherUserId) return false;\n        \n        // Don't show pending messages if a real message with similar content and timestamp exists\n        const hasRealCounterpart = filteredMessages.some(realMsg => {\n          const realMsgSenderId = typeof realMsg.senderId === 'object' ? (realMsg.senderId as any).id : realMsg.senderId;\n          return realMsgSenderId === state.currentUser?.id && \n                 realMsg.content === msg.content &&\n                 Math.abs(new Date(realMsg.timestamp).getTime() - new Date(msg.timestamp).getTime()) < 5000; // Within 5 seconds\n        });\n        \n        return !hasRealCounterpart;\n      })\n      .map(msg => ({\n        ...msg,\n        read: false,\n        isPending: true\n      }));\n    \n    // Combine and sort all messages\n    const allMessages = [...filteredMessages, ...conversationPendingMessages]\n      .sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n    \n    console.log('ðŸ” Filtered messages count:', filteredMessages.length, 'Pending:', conversationPendingMessages.length);\n    return allMessages;\n  }, [selectedConversation, conversations, state.messages, state.currentUser?.id, pendingMessages]);\n\n  // Get other user in selected conversation\n  const selectedConversationUser = useMemo(() => {\n    if (!selectedConversation) return null;\n    \n    const conversation = conversations.find(c => c.id === selectedConversation);\n    if (!conversation) return null;\n    \n    // For API conversations, use embedded otherUser data; for fallback conversations, find in state.users\n    const otherUser = (conversation as any).otherUser || (() => {\n      const otherUserId = conversation.participants.find(p => p !== state.currentUser?.id);\n      return state.users.find(u => u.id === otherUserId);\n    })();\n    \n    return otherUser || null;\n  }, [selectedConversation, conversations, state.users, state.currentUser?.id]);\n\n  const handleSendMessage = async () => {\n    if (!messageText.trim() || !selectedConversationUser || loading) return;\n\n    const tempMessage: PendingMessage = {\n      id: `temp-${Date.now()}`,\n      content: messageText.trim(),\n      timestamp: new Date().toISOString(),\n      senderId: state.currentUser!.id,\n      receiverId: selectedConversationUser.id,\n      status: 'sending'\n    };\n\n    // Add to pending messages immediately\n    setPendingMessages(prev => [...prev, tempMessage]);\n    setMessageText('');\n    setIsTyping(false);\n\n    // Auto-resize textarea back to single line\n    if (textareaRef.current) {\n      textareaRef.current.style.height = '40px';\n    }\n\n    setLoading(true);\n    try {\n      await sendMessage({\n        senderId: state.currentUser!.id,\n        receiverId: selectedConversationUser.id,\n        content: tempMessage.content\n      });\n      \n      // Mark as sent\n      setPendingMessages(prev => \n        prev.map(msg => \n          msg.id === tempMessage.id \n            ? { ...msg, status: 'sent' }\n            : msg\n        )\n      );\n\n      // Remove from pending after a short delay to show \"sent\" status\n      setTimeout(() => {\n        setPendingMessages(prev => prev.filter(msg => msg.id !== tempMessage.id));\n      }, 1000);\n\n    } catch (error) {\n      console.error('Error sending message:', error);\n      // Mark as failed\n      setPendingMessages(prev => \n        prev.map(msg => \n          msg.id === tempMessage.id \n            ? { ...msg, status: 'failed' }\n            : msg\n        )\n      );\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const handleTyping = (value: string) => {\n    setMessageText(value);\n    \n    // Auto-resize textarea\n    if (textareaRef.current) {\n      textareaRef.current.style.height = '40px';\n      textareaRef.current.style.height = `${Math.min(textareaRef.current.scrollHeight, 120)}px`;\n    }\n    \n    if (value.trim() && !isTyping) {\n      setIsTyping(true);\n      // In a real app, you'd emit typing indicator to other users via WebSocket\n    }\n\n    // Clear typing indicator after 2 seconds of no typing\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n    \n    typingTimeoutRef.current = setTimeout(() => {\n      setIsTyping(false);\n    }, 2000);\n  };\n\n  const handleConversationSelect = async (conversationId: string) => {\n    console.log('ðŸ” Selecting conversation:', conversationId);\n    \n    const conversation = conversations.find(c => c.id === conversationId);\n    console.log('ðŸ” Found conversation:', conversation ? {\n      id: conversation.id,\n      participants: conversation.participants,\n      otherUser: (conversation as any).otherUser ? {\n        id: (conversation as any).otherUser.id,\n        username: (conversation as any).otherUser.username\n      } : null\n    } : 'NOT FOUND');\n    \n    setSelectedConversation(conversationId);\n    \n    // Mark messages as read\n    if (conversation && conversation.unreadCount > 0) {\n      try {\n        await markMessagesAsRead(conversationId);\n      } catch (error) {\n        console.error('Error marking messages as read:', error);\n      }\n    }\n  };\n\n  const formatTime = (timestamp: string) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffInHours = (now.getTime() - date.getTime()) / (1000 * 60 * 60);\n    \n    if (diffInHours < 24) {\n      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    } else if (diffInHours < 168) { // 7 days\n      return date.toLocaleDateString([], { weekday: 'short' });\n    } else {\n      return date.toLocaleDateString([], { month: 'short', day: 'numeric' });\n    }\n  };\n\n  const formatMessageTime = (timestamp: string) => {\n    return new Date(timestamp).toLocaleTimeString([], { \n      hour: '2-digit', \n      minute: '2-digit' \n    });\n  };\n\n  const renderConversationsList = () => (\n    <div className=\"w-full lg:w-96 border-r border-primary-700/30 flex flex-col\">\n      {/* Header */}\n      <div className=\"p-4 border-b border-primary-700/30\">\n        <h2 className=\"text-xl font-bold text-primary-100 mb-4\">Messages</h2>\n        \n        {/* Search */}\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-primary-400\" />\n          <input\n            type=\"text\"\n            placeholder=\"Search conversations...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"input-field pl-10 text-sm\"\n          />\n        </div>\n      </div>\n\n      {/* Conversations List */}\n      <div className=\"flex-1 overflow-y-auto\">\n        {!state.conversations || state.conversations.length === 0 ? (\n          <div className=\"p-4 text-center\">\n            <MessageCircle className=\"w-12 h-12 mx-auto mb-4 text-primary-400\" />\n            <p className=\"text-primary-300\">\n              {!state.conversations ? 'Loading conversations...' : 'No conversations yet'}\n            </p>\n            <p className=\"text-sm text-primary-400 mt-1\">\n              {!state.conversations \n                ? 'Please wait while we load your messages'\n                : 'Start trading to begin messaging with other users'\n              }\n            </p>\n          </div>\n        ) : filteredConversations.length === 0 ? (\n          <div className=\"p-4 text-center\">\n            <MessageCircle className=\"w-12 h-12 mx-auto mb-4 text-primary-400\" />\n            <p className=\"text-primary-300\">No conversations match your search</p>\n            <p className=\"text-sm text-primary-400 mt-1\">\n              Try adjusting your search terms\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-1 p-2\">\n            {filteredConversations.map((conversation) => {\n              // For API conversations, use embedded otherUser data; for fallback conversations, find in state.users\n              const otherUser = (conversation as any).otherUser || (() => {\n                const otherUserId = conversation.participants.find(p => p !== state.currentUser?.id);\n                return state.users.find(u => u.id === otherUserId);\n              })();\n              const isSelected = selectedConversation === conversation.id;\n              \n              return (\n                <motion.div\n                  key={conversation.id}\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  onClick={() => handleConversationSelect(conversation.id)}\n                  className={`p-3 rounded-lg cursor-pointer transition-all ${\n                    isSelected\n                      ? 'bg-primary-600/30 border border-primary-500/50'\n                      : 'hover:bg-primary-800/30'\n                  }`}\n                >\n                  <div className=\"flex items-center space-x-3\">\n                    {/* Avatar */}\n                    <div className=\"relative\">\n                      <div className=\"w-12 h-12 bg-primary-800/50 rounded-full flex items-center justify-center\">\n                        {otherUser?.avatar ? (\n                          <img\n                            src={otherUser.avatar}\n                            alt={otherUser.username}\n                            className=\"w-full h-full object-cover rounded-full\"\n                          />\n                        ) : (\n                          <User className=\"w-6 h-6 text-primary-300\" />\n                        )}\n                      </div>\n                      {/* Online indicator could go here */}\n                    </div>\n                    \n                    {/* Content */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center justify-between\">\n                        <h4 className=\"font-medium text-primary-100 truncate\">\n                          @{otherUser?.username || 'Unknown'}\n                        </h4>\n                        <span className=\"text-xs text-primary-400\">\n                          {formatTime(conversation.lastMessage.timestamp)}\n                        </span>\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between mt-1\">\n                        <p className=\"text-sm text-primary-300 truncate\">\n                          {conversation.lastMessage.senderId === state.currentUser?.id && 'You: '}\n                          {conversation.lastMessage.content}\n                        </p>\n                        {conversation.unreadCount > 0 && (\n                          <span className=\"bg-blue-500 text-white text-xs px-2 py-1 rounded-full min-w-[20px] text-center\">\n                            {conversation.unreadCount > 99 ? '99+' : conversation.unreadCount}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </motion.div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n\n  const renderChatInterface = () => {\n    if (!selectedConversation || !selectedConversationUser) {\n      return (\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <MessageCircle className=\"w-16 h-16 mx-auto mb-4 text-primary-400\" />\n            <h3 className=\"text-xl font-semibold text-primary-100 mb-2\">Select a conversation</h3>\n            <p className=\"text-primary-300\">Choose a conversation to start messaging</p>\n          </div>\n        </div>\n      );\n    }\n\n    const typingUsersInConversation = typingUsers.filter(t => t.conversationId === selectedConversation);\n\n    return (\n      <div className=\"flex-1 flex flex-col h-full relative\">\n        {/* Chat Header */}\n        <div className=\"flex-shrink-0 p-4 border-b border-primary-700/30 flex items-center justify-between bg-primary-900/50 z-10\">\n          <div className=\"flex items-center space-x-3\">\n            <button\n              onClick={() => setSelectedConversation(null)}\n              className=\"lg:hidden p-2 hover:bg-primary-800/50 rounded-full transition-colors\"\n            >\n              <ArrowLeft className=\"w-5 h-5 text-primary-300\" />\n            </button>\n            \n            <div className=\"w-10 h-10 bg-primary-800/50 rounded-full flex items-center justify-center\">\n              {selectedConversationUser.avatar ? (\n                <img\n                  src={selectedConversationUser.avatar}\n                  alt={selectedConversationUser.username}\n                  className=\"w-full h-full object-cover rounded-full\"\n                />\n              ) : (\n                <User className=\"w-5 h-5 text-primary-300\" />\n              )}\n            </div>\n            \n            <div>\n              <h3 className=\"font-semibold text-primary-100\">\n                @{selectedConversationUser.username}\n              </h3>\n              {typingUsersInConversation.length > 0 && (\n                <p className=\"text-sm text-blue-400\">typing...</p>\n              )}\n            </div>\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            <button className=\"p-2 hover:bg-primary-800/50 rounded-full transition-colors\">\n              <Phone className=\"w-5 h-5 text-primary-300\" />\n            </button>\n            <button className=\"p-2 hover:bg-primary-800/50 rounded-full transition-colors\">\n              <Video className=\"w-5 h-5 text-primary-300\" />\n            </button>\n            <button className=\"p-2 hover:bg-primary-800/50 rounded-full transition-colors\">\n              <Info className=\"w-5 h-5 text-primary-300\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Messages Container - Takes all space above input */}\n        <div className=\"flex-1 overflow-hidden pb-20\">\n          <div className=\"h-full overflow-y-auto px-4 py-4 messages-scrollbar\">\n            {conversationMessages.length === 0 ? (\n              <div className=\"h-full flex items-center justify-center\">\n                <div className=\"text-center\">\n                  <p className=\"text-primary-300\">No messages yet</p>\n                  <p className=\"text-sm text-primary-400 mt-1\">Send a message to start the conversation</p>\n                </div>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {conversationMessages.map((message, index) => {\n                  // Ensure we're comparing the correct sender ID (handle both string and object)\n                  const messageSenderId = typeof message.senderId === 'object' ? (message.senderId as any).id : message.senderId;\n                  const isOwn = messageSenderId === state.currentUser?.id;\n                  const isPending = (message as any).isPending;\n                  const pendingStatus = isPending ? (message as any).status : null;\n                  \n                  // Debug logging for first few messages\n                  if (index < 3) {\n                    console.log('ðŸŽ¨ Message ownership check:', {\n                      messageId: message.id,\n                      originalSenderId: message.senderId,\n                      extractedSenderId: messageSenderId,\n                      currentUserId: state.currentUser?.id,\n                      isOwn: isOwn,\n                      isPending: isPending,\n                      content: message.content.substring(0, 20)\n                    });\n                  }\n                  \n                  const showAvatar = index === 0 || (() => {\n                    const prevMessageSenderId = typeof conversationMessages[index - 1].senderId === 'object' \n                      ? (conversationMessages[index - 1].senderId as any).id \n                      : conversationMessages[index - 1].senderId;\n                    return prevMessageSenderId !== messageSenderId;\n                  })();\n                  \n                  const isLastInGroup = index === conversationMessages.length - 1 || (() => {\n                    const nextMessageSenderId = typeof conversationMessages[index + 1].senderId === 'object'\n                      ? (conversationMessages[index + 1].senderId as any).id\n                      : conversationMessages[index + 1].senderId;\n                    return nextMessageSenderId !== messageSenderId;\n                  })();\n                  \n                  return (\n                    <motion.div\n                      key={message.id}\n                      initial={{ opacity: 0, y: 20 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      className={`flex ${isOwn ? 'justify-end' : 'justify-start'}`}\n                    >\n                      <div className={`flex items-end space-x-2 max-w-xs lg:max-w-md ${isOwn ? 'flex-row-reverse space-x-reverse' : ''}`}>\n                        {/* Avatar */}\n                        <div className=\"w-8 h-8 flex-shrink-0\">\n                          {showAvatar && !isOwn && (\n                            <div className=\"w-8 h-8 bg-primary-800/50 rounded-full flex items-center justify-center\">\n                              {selectedConversationUser.avatar ? (\n                                <img\n                                  src={selectedConversationUser.avatar}\n                                  alt={selectedConversationUser.username}\n                                  className=\"w-full h-full object-cover rounded-full\"\n                                />\n                              ) : (\n                                <User className=\"w-4 h-4 text-primary-300\" />\n                              )}\n                            </div>\n                          )}\n                        </div>\n                        \n                        {/* Message Bubble */}\n                        <div\n                          className={`px-4 py-2 rounded-2xl ${\n                            isOwn\n                              ? `bg-blue-600 text-white ${isPending && pendingStatus === 'sending' ? 'opacity-70' : ''} ${isPending && pendingStatus === 'failed' ? 'bg-red-600' : ''}`\n                              : 'bg-primary-700/50 text-primary-100'\n                          } ${\n                            isLastInGroup ? '' : 'mb-1'\n                          }`}\n                        >\n                          <p className=\"text-sm whitespace-pre-wrap\">{message.content}</p>\n                          \n                          {/* Message metadata */}\n                          <div className={`flex items-center justify-end mt-1 space-x-1 ${\n                            isOwn ? 'text-blue-200' : 'text-primary-400'\n                          }`}>\n                            <span className=\"text-xs\">\n                              {formatMessageTime(message.timestamp)}\n                            </span>\n                            {isOwn && (\n                              <div className=\"flex items-center\">\n                                {isPending ? (\n                                  pendingStatus === 'sending' ? (\n                                    <Clock className=\"w-3 h-3 animate-spin\" />\n                                  ) : pendingStatus === 'failed' ? (\n                                    <span className=\"text-xs text-red-200\">Failed</span>\n                                  ) : (\n                                    <Check className=\"w-3 h-3\" />\n                                  )\n                                ) : message.read ? (\n                                  <CheckCheck className=\"w-3 h-3\" />\n                                ) : (\n                                  <Check className=\"w-3 h-3\" />\n                                )}\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </motion.div>\n                  );\n                })}\n                \n                {/* Typing Indicator */}\n                {typingUsersInConversation.length > 0 && (\n                  <motion.div\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"flex items-end space-x-2\"\n                  >\n                    <div className=\"w-8 h-8 bg-primary-800/50 rounded-full flex items-center justify-center\">\n                      <User className=\"w-4 h-4 text-primary-300\" />\n                    </div>\n                    <div className=\"bg-primary-700/50 px-4 py-2 rounded-2xl\">\n                      <div className=\"flex space-x-1\">\n                        <div className=\"w-2 h-2 bg-primary-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                        <div className=\"w-2 h-2 bg-primary-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                        <div className=\"w-2 h-2 bg-primary-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n                      </div>\n                    </div>\n                  </motion.div>\n                )}\n                \n                <div ref={messagesEndRef} />\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Message Input - Absolutely positioned at bottom */}\n        <div className=\"absolute bottom-0 left-0 right-0 p-4 border-t border-primary-700/30 bg-primary-900/95 backdrop-blur-sm z-20\">\n          <div className=\"flex items-center space-x-3 max-w-4xl mx-auto\">\n            <div className=\"flex-1\">\n              <textarea\n                ref={textareaRef}\n                value={messageText}\n                onChange={(e) => handleTyping(e.target.value)}\n                onKeyPress={handleKeyPress}\n                placeholder=\"Type a message...\"\n                className=\"w-full px-4 py-3 bg-primary-800/50 border border-primary-600/30 rounded-2xl text-primary-100 placeholder-primary-400 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all scrollbar-none\"\n                style={{ \n                  minHeight: '48px',\n                  maxHeight: '120px',\n                  lineHeight: '1.5'\n                }}\n                rows={1}\n                disabled={loading}\n              />\n            </div>\n            <button\n              onClick={handleSendMessage}\n              disabled={!messageText.trim() || loading}\n              className={`w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 transition-all ${\n                messageText.trim() && !loading\n                  ? 'bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-xl'\n                  : 'bg-primary-700/50 text-primary-400 cursor-not-allowed'\n              }`}\n            >\n              <Send className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"h-full flex\">\n      {/* Mobile: Show either conversations list or chat */}\n      <div className=\"lg:hidden w-full h-full\">\n        {selectedConversation ? renderChatInterface() : renderConversationsList()}\n      </div>\n      \n      {/* Desktop: Show both side by side */}\n      <div className=\"hidden lg:flex w-full h-full\">\n        {renderConversationsList()}\n        {renderChatInterface()}\n      </div>\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}